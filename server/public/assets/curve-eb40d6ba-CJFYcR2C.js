import{R as Fe,u as ke,r as c,P as De,i as R,a as C}from"./index-DVZ7nus4.js";import{BoardContext as Oe,LINE_LAYER_OFFSET as Ce,VERTEX_LAYER_OFFSET as K,CONTROL_POINT_LAYER_OFFSET as ye}from"./graph-1a05b976-BUHOs_UM.js";import"./css-5483d03f-CnY6i4xu.js";const Le=Fe.memo(function A(Z){let{name:T,id:D,SVs:e,actions:m,sourceOfUpdate:W,callAction:b}=ke(Z);A.ignoreActionsWithoutCore=()=>!0;const o=c.useContext(Oe);let u=c.useRef(null),p=c.useRef(null),i=c.useRef(null),ee=c.useRef(null),_=c.useRef(null),E=c.useRef(null),Y=c.useRef(null),B=c.useRef(!1),J=c.useRef(!1),se=c.useRef(null),O=c.useRef(null),U=c.useRef(null),j=c.useRef(null),re=c.useRef(null),k=c.useRef(null),F=c.useRef(null),s=c.useRef([]),S=c.useRef(null),z=c.useRef(null),te=c.useRef(null),N=c.useRef(null),M=c.useRef(!1),X=c.useRef(!1),ne=c.useRef(!1),oe=c.useRef([]),I=c.useRef([]);M.current=e.fixed,X.current=!e.draggable||e.fixLocation||e.fixed,ne.current=e.switchable&&!e.fixed,te.current=e.vectorControlDirections;let fe=c.useRef(null);fe.current=e.numericalThroughPoints;let he=c.useRef(null);he.current=e.numericalControlPoints;const{darkMode:de}=c.useContext(De)||{};c.useEffect(()=>()=>{u.current&&ue(),o&&o.off("move",ge)},[]),c.useEffect(()=>{o&&o.on("move",ge)},[o]);function pe(){if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)return null;let r=de==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var t={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:M.current,layer:10*e.layer+Ce,strokeColor:r,strokeOpacity:e.selectedStyle.lineOpacity,strokeWidth:e.selectedStyle.lineWidth,dash:xe(e.selectedStyle.lineStyle,e.dashed),highlight:!1,lineCap:"butt"};if(e.labelForGraph!==""){let l,f,d;e.labelPosition==="upperright"?(d="urt",f=[-5,-10],l="right"):e.labelPosition==="upperleft"?(d="ulft",f=[5,-10],l="left"):e.labelPosition==="lowerright"?(d="lrt",f=[-5,10],l="right"):e.labelPosition==="lowerleft"?(d="llft",f=[5,10],l="left"):e.labelPosition==="top"?(d="top",f=[0,-10],l="left"):e.labelPosition==="bottom"?(d="bot",f=[0,10],l="left"):e.labelPosition==="left"?(d="lft",f=[10,0],l="left"):(d="rt",f=[-10,0],l="right"),t.label={offset:f,position:d,anchorx:l,highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0),e.applyStyleToLabel?t.label.strokeColor=r:t.label.strokeColor="var(canvastext)"}else t.label={highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0);let g;if(e.curveType==="parameterization"){let l=R(e.fDefinitions[0]),f=R(e.fDefinitions[1]);g=o.create("curve",[l,f,e.parMin,e.parMax],t)}else if(e.curveType==="bezier"){let l=R(e.fDefinitions[0]),f=R(e.fDefinitions[1]);g=o.create("curve",[l,f,e.parMin,e.parMax],t)}else{let l=R(e.fDefinitions[0]);if(e.flipFunction){let f=e.graphYmin,d=e.graphYmax,v=Math.max(f-(d-f)*.1,e.parMin),L=Math.min(d+(d-f)*.1,e.parMax);g=o.create("curve",[l,le=>le,v,L],t)}else{let f=e.graphXmin,d=e.graphXmax,v=Math.max(f-(d-f)*.1,e.parMin),L=Math.min(d+(d-f)*.1,e.parMax);g=o.create("functiongraph",[l,v,L],t)}se.current=e.flipFunction}return ee.current=e.curveType,_.current=null,E.current=null,g.isDraggable=!1,g.on("up",function(l){!J.current&&!M.current&&(ne.current&&b({action:m.switchCurve}),b({action:m.curveClicked,args:{name:T}})),B.current=!1}),g.on("keydown",function(l){l.key==="Enter"&&(ne.current&&b({action:m.switchCurve}),b({action:m.curveClicked,args:{name:T}}))}),e.curveType==="bezier"?(o.on("up",Pe),g.on("down",l=>{Y.current=[l.x,l.y],B.current=!0,J.current=!1,y(),M.current||b({action:m.curveFocused,args:{name:T}})}),g.on("hit",function(l){y(),b({action:m.curveFocused,args:{name:T}})}),O.current={visible:!1,withLabel:!1,fixed:!0,strokeColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",layer:10*e.layer+K,strokeWidth:1,highlightStrokeWidth:1},U.current={visible:!e.hidden,withLabel:!1,fixed:!1,fillColor:"none",strokeColor:"none",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+K,size:3,showInfoBox:e.showCoordsWhenDragging},j.current={fillcolor:"var(--mainGray)",strokecolor:"var(--mainGray)"},re.current={fillcolor:"none",strokecolor:"none"},k.current={visible:!1,withLabel:!1,fixed:!1,fillColor:"var(--mainGray)",strokeColor:"var(--mainGray)",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+ye,size:2,showInfoBox:e.showCoordsWhenDragging},X.current||(ve(),e.bezierControlsAlwaysVisible&&(ie(),Te()),o.updateRenderer(),F.current=e.numericalThroughPoints.length,N.current=[...e.vectorControlDirections])):(g.on("down",function(l){Y.current=[l.x,l.y],B.current=!0,J.current=!1,M.current||b({action:m.curveFocused,args:{name:T}})}),g.on("hit",function(l){b({action:m.curveFocused,args:{name:T}})})),g}function ge(r){B.current&&(Math.abs(r.x-Y.current[0])>.1||Math.abs(r.y-Y.current[1])>.1)&&(J.current=!0)}function ue(){o.off("up",Pe),u.current.off("down"),u.current.off("up"),u.current.off("keydown"),o.removeObject(u.current),u.current=null,me()}function ve(){p.current=[],i.current=[],s.current=[];for(let r=0;r<e.numericalThroughPoints.length;r++){let t=o.create("point",[...e.numericalThroughPoints[r]],U.current);p.current.push(t);let g=o.create("point",[...e.numericalControlPoints[r][0]],k.current),l=o.create("point",[...e.numericalControlPoints[r][1]],k.current);i.current.push([g,l]);let f=o.create("segment",[t,g],O.current),d=o.create("segment",[t,l],O.current);s.current.push([f,d]),t.on("drag",v=>be(r)),t.on("down",v=>Q(r,v)),t.on("hit",v=>Q(r,v)),t.on("up",v=>H(r)),t.on("keyfocusout",v=>H(r)),g.on("drag",v=>$(r,0)),l.on("drag",v=>$(r,1)),g.on("down",y),l.on("down",y),f.on("down",y),d.on("down",y),g.on("up",v=>q(r,0)),l.on("up",v=>q(r,1))}S.current=[]}function me(){s.current.length>0&&(s.current.forEach(r=>r.forEach(t=>{t&&(t.off("down"),o.removeObject(t))})),s.current=[],i.current.forEach(r=>r.forEach(t=>{t&&(t.off("drag"),t.off("down"),t.off("up"),o.removeObject(t))})),i.current=[],p.current.forEach(r=>{r.off("drag"),r.off("down"),r.off("hit"),r.off("up"),r.off("keyfocusout"),o.removeObject(r)}),p.current=[])}function Q(r,t){if(X.current)return;E.current=null,_.current=null;let g=t.type==="pointerdown";z.current=g,ie(),V(r),o.updateRenderer()}function be(r){E.current=r,oe.current[r]=[p.current[r].X(),p.current[r].Y()],b({action:m.moveThroughPoint,args:{throughPoint:oe.current[r],throughPointInd:r,transient:!0,skippable:!0}}),p.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,fe.current[r]),o.updateInfobox(p.current[r])}function H(r){E.current===r&&b({action:m.moveThroughPoint,args:{throughPoint:oe.current[r],throughPointInd:r}})}function $(r,t){_.current=r+"_"+t,I.current[r]||(I.current[r]={}),I.current[r][t]=[i.current[r][t].X()-p.current[r].X(),i.current[r][t].Y()-p.current[r].Y()],b({action:m.moveControlVector,args:{controlVector:I.current[r][t],controlVectorInds:[r,t],transient:!0,skippable:!0}}),i.current[r][t].coords.setCoordinates(JXG.COORDS_BY_USER,[...he.current[r][t]]),o.updateInfobox(i.current[r][t])}function q(r,t){_.current===r+"_"+t&&b({action:m.moveControlVector,args:{controlVector:I.current[r][t],controlVectorInds:[r,t]}})}function ie(){for(let r of p.current){for(let t in j.current)r.visProp[t]=j.current[t];r.needsUpdate=!0,r.update()}}function we(){for(let r of p.current){for(let t in re.current)r.visProp[t]=re.current[t];r.needsUpdate=!0,r.update()}}function Re(){for(let r of i.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());for(let r of s.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());S.current=[]}function Te(){for(let r in i.current)V(r)}function Pe(){X.current||(z.current!==!0&&!e.bezierControlsAlwaysVisible&&(we(),Re(),o.updateRenderer()),z.current=!1)}function V(r){if(!e.hiddenControls[r]){if(i.current[r][0]){let t=(r>0||e.extrapolateBackward)&&["symmetric","both","previous"].includes(te.current[r]);i.current[r][0].visProp.visible=t,i.current[r][0].visPropCalc.visible=t,i.current[r][0].needsUpdate=!0,i.current[r][0].update(),s.current[r][0].visProp.visible=t,s.current[r][0].visPropCalc.visible=t,s.current[r][0].needsUpdate=!0,s.current[r][0].update()}if(i.current[r][1]){let t=(r<p.current.length-1||e.extrapolateForward)&&["symmetric","both","next"].includes(te.current[r]);i.current[r][1].visProp.visible=t,i.current[r][1].visPropCalc.visible=t,i.current[r][1].needsUpdate=!0,i.current[r][1].update(),s.current[r][1].visProp.visible=t,s.current[r][1].visPropCalc.visible=t,s.current[r][1].needsUpdate=!0,s.current[r][1].update()}S.current[r]=!0}}function y(){X.current||(E.current=null,_.current=null,z.current=!0,ie(),o.updateRenderer())}if(o)if(!u.current)u.current=pe();else if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)ue();else if(ee.current!==e.curveType||ee.current==="function"&&se.current!==e.flipFunction)ue(),u.current=pe(),o.updateQuality===o.BOARD_QUALITY_LOW&&(o.itemsRenderedLowQuality[D]=u.current);else{o.updateQuality===o.BOARD_QUALITY_LOW&&(o.itemsRenderedLowQuality[D]=u.current);let r=!e.hidden;u.current.name=e.labelForGraph,u.current.visProp.visible=r,u.current.visPropCalc.visible=r;let t=10*e.layer+Ce,g=u.current.visProp.layer!==t,l,f,d;g&&(u.current.setAttribute({layer:t}),e.curveType==="bezier"&&(l=10*e.layer+K,f=10*e.layer+K,d=10*e.layer+ye,O.current.layer=l,U.current.layer=f,k.current.layer=d));let v=de==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;u.current.visProp.strokecolor!==v&&(u.current.visProp.strokecolor=v,u.current.visProp.highlightstrokecolor=v),u.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(u.current.visProp.strokeopacity=e.selectedStyle.lineOpacity);let L=xe(e.selectedStyle.lineStyle,e.dashed);if(u.current.visProp.dash!==L&&(u.current.visProp.dash=L),u.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(u.current.visProp.strokewidth=e.selectedStyle.lineWidth),e.curveType==="parameterization"){let n=R(e.fDefinitions[0]),h=R(e.fDefinitions[1]);u.current.X=n,u.current.Y=h,u.current.minX=()=>e.parMin,u.current.maxX=()=>e.parMax}else if(e.curveType==="bezier")u.current.X=R(e.fDefinitions[0]),u.current.Y=R(e.fDefinitions[1]),u.current.minX=()=>e.parMin,u.current.maxX=()=>e.parMax,U.current.showInfoBox=e.showCoordsWhenDragging,k.current.showInfoBox=e.showCoordsWhenDragging;else{let n=R(e.fDefinitions[0]);if(e.flipFunction){u.current.X=n;let h=e.graphYmin,a=e.graphYmax,P=Math.max(h-(a-h)*.1,e.parMin),x=Math.min(a+(a-h)*.1,e.parMax);u.current.minX=()=>P,u.current.maxX=()=>x}else{u.current.Y=n;let h=e.graphXmin,a=e.graphXmax,P=Math.max(h-(a-h)*.1,e.parMin),x=Math.min(a+(a-h)*.1,e.parMax);u.current.minX=()=>P,u.current.maxX=()=>x}}if(u.current.visProp.fixed=M.current,u.current.needsUpdate=!0,u.current.updateCurve(),u.current.hasLabel&&(u.current.label.needsUpdate=!0,u.current.label.visPropCalc.visible=e.labelForGraph!=="",e.applyStyleToLabel?u.current.label.visProp.strokecolor=v:u.current.label.visProp.strokecolor="var(canvastext)",u.current.label.update()),e.curveType!=="bezier")return o.updateRenderer(),C.jsx(C.Fragment,{children:C.jsx("a",{name:D})});if(X.current)return s.current.length>0&&me(),o.updateRenderer(),C.jsx(C.Fragment,{children:C.jsx("a",{name:D})});if(s.current.length===0)return ve(),F.current=e.numericalThroughPoints.length,N.current=[...e.vectorControlDirections],o.updateRenderer(),C.jsx(C.Fragment,{children:C.jsx("a",{name:D})});if(e.numericalThroughPoints.length>F.current){let n=F.current-1,h=Object.assign({},U.current);p.current[n].visProp.fillcolor===j.current.fillcolor&&Object.assign(h,j.current);for(let a=F.current;a<e.numericalThroughPoints.length;a++){let P=o.create("point",[...e.numericalThroughPoints[a]],h);p.current.push(P);let x=o.create("point",[...e.numericalControlPoints[a][0]],k.current),G=o.create("point",[...e.numericalControlPoints[a][1]],k.current);i.current.push([x,G]);let ce=o.create("segment",[P,x],O.current),ae=o.create("segment",[P,G],O.current);s.current.push([ce,ae]),x.visProp.visible=!1,ce.visProp.visible=!1,G.visProp.visible=!1,ae.visProp.visible=!1,P.on("drag",w=>be(a)),P.on("down",w=>Q(a,w)),P.on("hit",w=>Q(a,w)),P.on("up",w=>H(a)),P.on("keyfocusout",w=>H(a)),x.on("drag",w=>$(a,0)),x.on("down",y),x.on("up",w=>q(a,0)),G.on("drag",w=>$(a,1)),G.on("down",y),G.on("up",w=>q(a,1)),ce.on("down",y),ae.on("down",y)}S.current[n]&&V(n)}else if(e.numericalThroughPoints.length<F.current){for(let h=F.current-1;h>=e.numericalThroughPoints.length;h--){s.current[h][0].off("down"),s.current[h][1].off("down"),o.removeObject(s.current[h][0]),o.removeObject(s.current[h][1]),s.current.pop(),i.current[h][0].off("drag"),i.current[h][0].off("down"),i.current[h][0].off("up"),i.current[h][1].off("drag"),i.current[h][1].off("down"),i.current[h][1].off("up"),o.removeObject(i.current[h][0]),o.removeObject(i.current[h][1]),i.current.pop();let a=p.current.pop();a.off("drag"),a.off("down"),a.off("up"),a.off("hit"),a.off("keyfocusout"),o.removeObject(a)}let n=e.numericalThroughPoints.length-1;S.current[n]&&V(n)}let le=Math.min(e.numericalThroughPoints.length,F.current);for(let n=0;n<le;n++)N.current[n]!==e.vectorControlDirections[n]&&S.current[n]&&V(n),g&&(p.current[n].setAttribute({layer:f}),s.current[n][0].setAttribute({layer:l}),i.current[n][0].setAttribute({layer:d}),s.current[n][1].setAttribute({layer:l}),i.current[n][1].setAttribute({layer:d})),p.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalThroughPoints[n]]),p.current[n].visProp.showinfobox=e.showCoordsWhenDragging,p.current[n].needsUpdate=!0,p.current[n].update(),i.current[n][0].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][0]]),i.current[n][0].visProp.showinfobox=e.showCoordsWhenDragging,i.current[n][0].needsUpdate=!0,i.current[n][0].update(),s.current[n][0].needsUpdate=!0,s.current[n][0].update(),i.current[n][1].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][1]]),i.current[n][1].visProp.showinfobox=e.showCoordsWhenDragging,i.current[n][1].needsUpdate=!0,i.current[n][1].update(),s.current[n][1].needsUpdate=!0,s.current[n][1].update();for(let n=0;n<e.numericalThroughPoints.length;n++)p.current[n].visProp.visible=!e.hidden,p.current[n].visPropCalc.visible=!e.hidden;if(W.sourceInformation&&T in W.sourceInformation){let n=W.sourceInformation[T].throughPointMoved;n!==void 0?o.updateInfobox(p.current[n]):(n=W.sourceInformation[T].controlVectorMoved,n!==void 0&&o.updateInfobox(i.current[n[0]][n[1]]))}F.current=e.numericalThroughPoints.length,N.current=[...e.vectorControlDirections],o.updateRenderer()}return e.hidden?null:C.jsx(C.Fragment,{children:C.jsx("a",{name:D})})});function xe(A,Z){return A==="dashed"||Z?2:A==="solid"?0:A==="dotted"?1:0}export{Le as default};
