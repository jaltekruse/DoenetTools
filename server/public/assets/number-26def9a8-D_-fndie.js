import{R as oe,u as ce,r as o,P as se,C as V,a as b,ag as ue,M as ie}from"./index-CrSqH__w.js";import{BoardContext as le,TEXT_LAYER_OFFSET as H}from"./graph-5fd7c87e-CqVNngzu.js";import{g as I}from"./graph-462f764a-C0kM6xFY.js";import"./css-5483d03f-CnY6i4xu.js";const pe=oe.memo(function W(q){let{name:S,id:N,SVs:r,actions:a,sourceOfUpdate:ae,callAction:d}=ce(q);W.ignoreActionsWithoutCore=()=>!0;let e=o.useRef(null),P=o.useRef(null),_=o.useRef(null);const c=o.useContext(le);let g=o.useRef(!1),A=o.useRef(!1),D=o.useRef(!1),X=o.useRef(!1),l=o.useRef(!1),f=o.useRef(null),h=o.useRef(null),B=o.useRef(null),O=o.useRef(null),C=o.useRef(!1),v=o.useRef(!1);C.current=r.fixed,v.current=!r.draggable||r.fixLocation||r.fixed;const{darkMode:k}=o.useContext(se)||{};o.useEffect(()=>()=>{e.current!==null&&Q(),c&&c.off("move",T)},[]),o.useEffect(()=>{c&&c.on("move",T)},[c]);function K(){let u=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,i=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,y="";i&&(y+=`background-color: ${i}`);let m={visible:!r.hidden,fixed:C.current,layer:10*r.layer+H,cssStyle:y,highlightCssStyle:y,strokeColor:u,strokeOpacity:1,highlightStrokeColor:u,highlightStrokeOpacity:.5,highlight:!v.current,parse:!1},s;try{let t=V.fromAst(r.anchor),x=[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()];Number.isFinite(x[0])||(x[0]=0,m.visible=!1),Number.isFinite(x[1])||(x[1]=0,m.visible=!1),s=c.create("point",x,{visible:!1})}catch{m.visible=!1,s=c.create("point",[0,0],{visible:!1})}m.anchor=s;let{anchorx:R,anchory:p}=I(r.positionFromAnchor);m.anchorx=R,m.anchory=p,_.current=[R,p];let n=c.create("text",[0,0,r.text],m);n.isDraggable=!v.current,n.on("down",function(t){g.current=[t.x,t.y],A.current=[...s.coords.scrCoords],l.current=!1,D.current=!0,X.current=!1,C.current||d({action:a.numberFocused,args:{name:S}})}),n.on("hit",function(t){A.current=[...s.coords.scrCoords],l.current=!1,d({action:a.numberFocused,args:{name:S}})}),n.on("up",function(t){l.current?(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1):!X.current&&!C.current&&d({action:a.numberClicked,args:{name:S}}),D.current=!1}),n.on("keyfocusout",function(t){l.current&&(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1)}),n.on("drag",function(t){let x=t.type==="pointermove";(!x||Math.abs(t.x-g.current[0])>.1||Math.abs(t.y-g.current[1])>.1)&&(l.current=!0);let[E,w,J,G]=c.getBoundingBox(),U=n.size[0]/c.unitX,Y=n.size[1]/c.unitY,$=_.current[0],L=_.current[1],M=0;$==="middle"?M=-U/2:$==="right"&&(M=-U);let F=0;L==="middle"?F=-Y/2:L==="top"&&(F=-Y);let ee=E+.04*(J-E)-M-U,re=J-.04*(J-E)-M,te=G+.04*(w-G)-F-Y,ne=w-.04*(w-G)-F;if(x){var z=c.origin.scrCoords;f.current=(A.current[1]+t.x-g.current[0]-z[1])/c.unitX,h.current=(z[2]-(A.current[2]+t.y-g.current[1]))/c.unitY}else f.current=s.X()+n.relativeCoords.usrCoords[1],h.current=s.Y()+n.relativeCoords.usrCoords[2];f.current=Math.min(re,Math.max(ee,f.current)),h.current=Math.min(ne,Math.max(te,h.current)),d({action:a.moveNumber,args:{x:f.current,y:h.current,transient:!0,skippable:!0}}),n.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,B.current)}),n.on("keydown",function(t){t.key==="Enter"&&(l.current&&(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1),d({action:a.numberClicked,args:{name:S}}))}),e.current=n,P.current=s,O.current=r.positionFromAnchor}function T(u){D.current&&(Math.abs(u.x-g.current[0])>.1||Math.abs(u.y-g.current[1])>.1)&&(X.current=!0)}function Q(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),c.removeObject(e.current),e.current=null}if(c){let u;try{let i=V.fromAst(r.anchor);u=[i.get_component(0).evaluate_to_constant(),i.get_component(1).evaluate_to_constant()]}catch{u=[NaN,NaN]}if(B.current=u,e.current===null)K();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),P.current.coords.setCoordinates(JXG.COORDS_BY_USER,u),e.current.setText(r.text);let i=!r.hidden;if(Number.isFinite(u[0])&&Number.isFinite(u[1])){let n=e.current.visProp.visible!==i;e.current.visProp.visible=i,e.current.visPropCalc.visible=i,n&&e.current.setAttribute({visible:i})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let y=10*r.layer+H;e.current.visProp.layer!==y&&e.current.setAttribute({layer:y});let s=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,R=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,p="";if(R?p+=`background-color: ${R}`:p+="background-color: transparent",e.current.visProp.strokecolor!==s&&(e.current.visProp.strokecolor=s,e.current.visProp.highlightstrokecolor=s),e.current.visProp.cssstyle!==p&&(e.current.visProp.cssstyle=p,e.current.visProp.highlightcssstyle=p),e.current.visProp.highlight=!v.current,e.current.visProp.fixed=C.current,e.current.isDraggable=!v.current,e.current.needsUpdate=!0,r.positionFromAnchor!==O.current){let{anchorx:n,anchory:t}=I(r.positionFromAnchor);e.current.visProp.anchorx=n,e.current.visProp.anchory=t,_.current=[n,t],O.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();P.current.needsUpdate=!0,P.current.update(),c.updateRenderer()}return b.jsx("a",{name:N})}if(r.hidden)return null;let j=r.text;r.renderAsMath&&(j="\\("+j+"\\)");let Z=ue(k,r.selectedStyle);return b.jsxs(b.Fragment,{children:[b.jsx("a",{name:N}),b.jsx("span",{id:N,style:Z,children:b.jsx(ie,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:j})})]})});export{pe as default};
