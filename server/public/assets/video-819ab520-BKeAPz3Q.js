import{q as G,R as W,u as _,r as l,a as g,V as L}from"./index-CrSqH__w.js";import{s as M}from"./css-5483d03f-CnY6i4xu.js";const q=G.div`
    &: focus {
        outline: 2px solid var(--canvastext);
        outline-offset: 2px;
    }
`,H=W.memo(function(k){var V;let{name:F,id:T,SVs:n,actions:a,callAction:u}=_(k),r=l.useRef(null),f=l.useRef(null),o=l.useRef(null),i=l.useRef([]),s=l.useRef(null),C=l.useRef(null),P=l.useRef(0),d=l.useRef(null),w=l.useRef(null),p=l.useRef(null),I=e=>{u({action:a.recordVisibilityChange,args:{isVisible:e}})};l.useEffect(()=>()=>{u({action:a.recordVisibilityChange,args:{isVisible:!1}})},[]),l.useEffect(()=>{if(n.youtube){let e=T;window.YT&&(r.current=new window.YT.Player(e,{playerVars:{autoplay:0,controls:1,modestbranding:1,rel:0},events:{onReady:N,onStateChange:j,onPlaybackRateChange:U}}))}},[window.YT]);function A(){let e=r.current.getCurrentTime(),t;f.current?t=e-f.current:t=e-o.current,!(o.current>=0)||t>0&&t<1?(o.current=e,f.current=null):t!==0&&(f.current=e);let m=Math.floor(e);m!==p.current&&(p.current=m,u({action:a.setTime,args:{time:m}}))}function N(e){u({action:a.recordVideoReady,args:{duration:r.current.getDuration()}})}function j(e){let t=r.current.getDuration();switch(e.data){case window.YT.PlayerState.PLAYING:if(s.current!==e.data){let c=r.current.getCurrentTime();if(clearInterval(w.current),w.current=window.setInterval(A,200),s.current===window.YT.PlayerState.PAUSED){let D=c-P.current;(D<0||D>.5)&&u({action:a.recordVideoSkipped,args:{beginTime:P.current,endTime:c,duration:t}})}let v=r.current.getPlaybackRate();i.current=[{startingPoint:c,rate:v}],d.current=c,o.current=c,f.current=null,u({action:a.recordVideoStarted,args:{beginTime:r.current.getCurrentTime(),duration:t,rate:v}}),s.current=e.data}break;case window.YT.PlayerState.PAUSED:let m=s.current,x=d.current,y=r.current.getCurrentTime();C.current=setTimeout(function(){clearInterval(w.current),m===window.YT.PlayerState.PLAYING&&y>x&&(i.current[i.current.length-1].endingPoint=y,u({action:a.recordVideoWatched,args:{beginTime:x,endTime:y,duration:t,rates:i.current}}),d.current=null),u({action:a.recordVideoPaused,args:{endTime:y,duration:t}}),P.current=y,s.current=e.data},250);break;case window.YT.PlayerState.BUFFERING:clearTimeout(C.current);let E=r.current.getCurrentTime();if(d.current!==null){let c=d.current;o.current>c&&(i.current[i.current.length-1].endingPoint=o.current,u({action:a.recordVideoWatched,args:{beginTime:c,endTime:o.current,duration:t,rates:i.current}}),c=o.current),u({action:a.recordVideoSkipped,args:{beginTime:c,endTime:E,duration:t}}),s.current=e.data,d.current=null,o.current=E,f.current=null}break;case window.YT.PlayerState.ENDED:clearInterval(w.current);let h=d.current,R=r.current.getCurrentTime();i.current.length>0&&h!==null&&R>h&&(i.current[i.current.length-1].endingPoint=R,u({action:a.recordVideoWatched,args:{beginTime:h,endTime:R,duration:t,rates:i.current}}),d.current=null),u({action:a.recordVideoCompleted,args:{duration:t}}),s.current=e.data;break;case window.YT.PlayerState.UNSTARTED:s.current=e.data;break}}function U(e){let t=r.current.getCurrentTime();i.current[i.current.length-1].endingPoint=t,i.current.push({startingPoint:t,rate:e.data})}if((V=r.current)!=null&&V.getPlayerState){let e=r.current.getPlayerState();if(n.state==="playing"?(e===window.YT.PlayerState.UNSTARTED||e===window.YT.PlayerState.PAUSED||e===window.YT.PlayerState.CUED||e===window.YT.PlayerState.ENDED)&&r.current.playVideo():n.state==="stopped"&&e===window.YT.PlayerState.PLAYING&&r.current.pauseVideo(),n.time!==Number(p.current)){let t=n.time,m=r.current.getDuration();t>m&&(t=Math.floor(m),u({action:a.setTime,args:{time:t}})),t!==Number(p.current)&&(r.current.getPlayerState()===window.YT.PlayerState.CUED?(r.current.pauseVideo(),r.current.seekTo(t,!0),setTimeout(()=>r.current.pauseVideo(),200)):r.current.seekTo(t,!0),p.current=t)}}if(n.hidden)return null;let b={};n.displayMode==="inline"?b={display:"inline-block",verticalAlign:"middle",margin:"12px 0"}:b={display:"flex",justifyContent:n.horizontalAlign,margin:"12px 0"};let Y={maxWidth:"100%",width:M(n.width),aspectRatio:String(n.aspectRatio)},S;return n.youtube?S=g.jsx("iframe",{id:T,style:Y,src:"https://www.youtube.com/embed/"+n.youtube+"?enablejsapi=1&rel=0&modestbranding=1",allow:"autoplay; fullscreen"}):n.source?S=g.jsxs("video",{className:"video",id:T,controls:!0,style:Y,children:[g.jsx("source",{src:n.source,type:`video/${n.source.split("/").pop().split(".").pop()}`}),"Your browser does not support the <video> tag."]}):S=g.jsx("span",{id:T}),g.jsx(L,{partialVisibility:!0,onChange:I,children:g.jsxs(q,{tabIndex:"0",style:b,id:T+"_outer",children:[g.jsx("a",{name:T}),S]})})});export{H as default};
