import{R as W,u as q,r as u,C as N,a as A,h as I}from"./index-CrSqH__w.js";import{BoardContext as K}from"./graph-5fd7c87e-CqVNngzu.js";import{g as U}from"./graph-462f764a-C0kM6xFY.js";import"./css-5483d03f-CnY6i4xu.js";const ne=W.memo(function Y(M){let{name:Q,id:h,SVs:t,actions:m,callAction:p}=q(M,!1);Y.ignoreActionsWithoutCore=o=>o==="moveButton";let e=u.useRef(null),v=u.useRef(null),y=u.useRef(null);const i=u.useContext(K);let x=u.useRef(!1),_=u.useRef(!1),c=u.useRef(!1),s=u.useRef(null),l=u.useRef(null),D=u.useRef(null),B=u.useRef(null),P=u.useRef(!1),X=u.useRef(!1);P.current=t.fixed,X.current=!t.draggable||t.fixLocation||t.fixed;let C=t.label?t.label:"Button";u.useEffect(()=>()=>{e.current!==null&&H()},[]);function L(){let o={visible:!t.hidden,fixed:P.current,disabled:t.disabled,useMathJax:t.labelHasLatex,parse:!1},r;try{let n=N.fromAst(t.anchor),d=[n.get_component(0).evaluate_to_constant(),n.get_component(1).evaluate_to_constant()];Number.isFinite(d[0])||(d[0]=0,o.visible=!1),Number.isFinite(d[1])||(d[1]=0,o.visible=!1),r=i.create("point",d,{visible:!1})}catch{o.visible=!1,r=i.create("point",[0,0],{visible:!1});return}o.anchor=r;let{anchorx:f,anchory:b}=U(t.positionFromAnchor);o.anchorx=f,o.anchory=b,y.current=[f,b];let a=i.create("button",[0,0,C,()=>p({action:m[t.clickAction]})],o);a.isDraggable=!X.current,a.on("down",function(n){x.current=[n.x,n.y],_.current=[...r.coords.scrCoords],c.current=!1}),a.on("hit",function(n){c.current=!1}),a.on("up",function(n){c.current&&(p({action:m.moveButton,args:{x:s.current,y:l.current}}),c.current=!1)}),a.on("keyfocusout",function(n){c.current&&(p({action:m.moveButton,args:{x:s.current,y:l.current}}),c.current=!1)}),a.on("drag",function(n){let d=n.type==="pointermove";(!d||Math.abs(n.x-x.current[0])>.1||Math.abs(n.y-x.current[1])>.1)&&(c.current=!0);let[F,j,J,k]=i.getBoundingBox(),G=a.size[0]/i.unitX,w=a.size[1]/i.unitY,O=y.current[0],S=y.current[1],g=0;O==="middle"?g=-G/2:O==="right"&&(g=-G);let R=0;S==="middle"?R=-w/2:S==="top"&&(R=-w);let T=F+.04*(J-F)-g-G,z=J-.04*(J-F)-g,V=k+.04*(j-k)-R-w,$=j-.04*(j-k)-R;if(d){var E=i.origin.scrCoords;s.current=(_.current[1]+n.x-x.current[0]-E[1])/i.unitX,l.current=(E[2]-(_.current[2]+n.y-x.current[1]))/i.unitY}else s.current=r.X()+a.relativeCoords.usrCoords[1],l.current=r.Y()+a.relativeCoords.usrCoords[2];s.current=Math.min(z,Math.max(T,s.current)),l.current=Math.min($,Math.max(V,l.current)),p({action:m.moveButton,args:{x:s.current,y:l.current,transient:!0,skippable:!0}}),a.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),r.coords.setCoordinates(JXG.COORDS_BY_USER,D.current)}),a.on("keydown",function(n){n.key==="Enter"&&c.current&&(p({action:m.moveButton,args:{x:s.current,y:l.current}}),c.current=!1)}),e.current=a,v.current=r,B.current=t.positionFromAnchor,t.labelHasLatex&&setTimeout(()=>{e.current&&(e.current.needsUpdate=!0,e.current.setText(C),e.current.update(),i==null||i.updateRenderer())},1e3)}function H(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),i.removeObject(e.current),e.current=null}if(i){let o;try{let r=N.fromAst(t.anchor);o=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()]}catch{o=[NaN,NaN]}if(D.current=o,e.current===null)L();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),v.current.coords.setCoordinates(JXG.COORDS_BY_USER,o),e.current.setText(C);let r=!t.hidden;if(Number.isFinite(o[0])&&Number.isFinite(o[1])){let f=e.current.visProp.visible!==r;e.current.visProp.visible=r,e.current.visPropCalc.visible=r,f&&e.current.setAttribute({visible:r})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;if(e.current.visProp.disabled!==t.disabled&&(e.current.visProp.disabled=t.disabled,e.current.setAttribute({disabled:t.disabled})),e.current.visProp.fixed=P.current,e.current.isDraggable=!X.current,e.current.needsUpdate=!0,t.positionFromAnchor!==B.current){let{anchorx:f,anchory:b}=U(t.positionFromAnchor);e.current.visProp.anchorx=f,e.current.visProp.anchory=b,y.current=[f,b],B.current=t.positionFromAnchor,e.current.fullUpdate()}else e.current.update();v.current.needsUpdate=!0,v.current.update(),i.updateRenderer()}return A.jsx("a",{name:h})}return t.hidden?null:A.jsxs("div",{id:h,margin:"12px 0",style:{display:"inline-block"},children:[A.jsx("a",{name:h}),A.jsx(I,{id:h+"_button",onClick:()=>p({action:m[t.clickAction]}),disabled:t.disabled,value:C,valueHasLatex:t.labelHasLatex})]})});export{ne as default};
