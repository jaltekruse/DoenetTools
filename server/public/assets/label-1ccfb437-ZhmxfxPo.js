import{R as oe,u as le,r as l,P as ce,C as V,a as F,ag as ae,M as ie}from"./index-CrSqH__w.js";import{BoardContext as se,TEXT_LAYER_OFFSET as H}from"./graph-5fd7c87e-CqVNngzu.js";import{g as I}from"./graph-462f764a-C0kM6xFY.js";import"./css-5483d03f-CnY6i4xu.js";const xe=oe.memo(function W(q){let{name:R,id:D,SVs:r,children:ue,actions:u,callAction:d}=le(q);W.ignoreActionsWithoutCore=()=>!0;let e=l.useRef(null),S=l.useRef(null),P=l.useRef(null);const n=l.useContext(se);let y=l.useRef(null),_=l.useRef(null),L=l.useRef(!1),X=l.useRef(!1),s=l.useRef(!1),f=l.useRef(null),h=l.useRef(null),B=l.useRef(null),E=l.useRef(null),m=l.useRef(!1),v=l.useRef(!1);m.current=r.fixed,v.current=!r.draggable||r.fixLocation||r.fixed;const{darkMode:C}=l.useContext(ce)||{};l.useEffect(()=>()=>{e.current!==null&&Q(),n&&n.off("move",N)},[]),l.useEffect(()=>{n&&n.on("move",N)},[n]);function K(){let a=C==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,i=C==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,b="";i&&(b+=`background-color: ${i}`);let p={visible:!r.hidden,fixed:m.current,layer:10*r.layer+H,cssStyle:b,highlightCssStyle:b,strokeColor:a,strokeOpacity:1,highlightStrokeColor:a,highlightStrokeOpacity:.5,highlight:!v.current,useMathJax:r.hasLatex,parse:!1},c;try{let t=V.fromAst(r.anchor),g=[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()];Number.isFinite(g[0])||(g[0]=0,p.visible=!1),Number.isFinite(g[1])||(g[1]=0,p.visible=!1),c=n.create("point",g,{visible:!1})}catch{p.visible=!1,c=n.create("point",[0,0],{visible:!1})}p.anchor=c;let{anchorx:k,anchory:x}=I(r.positionFromAnchor);p.anchorx=k,p.anchory=x,P.current=[k,x];let o=n.create("text",[0,0,r.value],p);o.isDraggable=!v.current,o.on("down",function(t){y.current=[t.x,t.y],_.current=[...c.coords.scrCoords],s.current=!1,L.current=!0,X.current=!1,m.current||d({action:u.labelFocused,args:{name:R}})}),o.on("hit",function(t){_.current=[...c.coords.scrCoords],s.current=!1,d({action:u.labelFocused,args:{name:R}})}),o.on("up",function(t){s.current?(d({action:u.moveLabel,args:{x:f.current,y:h.current}}),s.current=!1):!X.current&&!m.current&&d({action:u.labelClicked,args:{name:R}}),L.current=!1}),o.on("keyfocusout",function(t){s.current&&(d({action:u.moveLabel,args:{x:f.current,y:h.current}}),s.current=!1)}),o.on("drag",function(t){let g=t.type==="pointermove";(!g||Math.abs(t.x-y.current[0])>.1||Math.abs(t.y-y.current[1])>.1)&&(s.current=!0);let[O,j,w,G]=n.getBoundingBox(),U=o.size[0]/n.unitX,Y=o.size[1]/n.unitY,T=P.current[0],$=P.current[1],A=0;T==="middle"?A=-U/2:T==="right"&&(A=-U);let M=0;$==="middle"?M=-Y/2:$==="top"&&(M=-Y);let ee=O+.04*(w-O)-A-U,re=w-.04*(w-O)-A,te=G+.04*(j-G)-M-Y,ne=j-.04*(j-G)-M;if(g){var z=n.origin.scrCoords;f.current=(_.current[1]+t.x-y.current[0]-z[1])/n.unitX,h.current=(z[2]-(_.current[2]+t.y-y.current[1]))/n.unitY}else f.current=c.X()+o.relativeCoords.usrCoords[1],h.current=c.Y()+o.relativeCoords.usrCoords[2];f.current=Math.min(re,Math.max(ee,f.current)),h.current=Math.min(ne,Math.max(te,h.current)),d({action:u.moveLabel,args:{x:f.current,y:h.current,transient:!0,skippable:!0}}),o.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),c.coords.setCoordinates(JXG.COORDS_BY_USER,B.current)}),o.on("keydown",function(t){t.key==="Enter"&&(s.current&&(d({action:u.moveLabel,args:{x:f.current,y:h.current}}),s.current=!1),d({action:u.labelClicked,args:{name:R}}))}),e.current=o,S.current=c,E.current=r.positionFromAnchor,r.hasLatex&&setTimeout(()=>{e.current&&(e.current.needsUpdate=!0,e.current.setText(r.value),e.current.update(),n==null||n.updateRenderer())},1e3)}function N(a){L.current&&(Math.abs(a.x-y.current[0])>.1||Math.abs(a.y-y.current[1])>.1)&&(X.current=!0)}function Q(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),n.removeObject(e.current),e.current=null}if(n){let a;try{let i=V.fromAst(r.anchor);a=[i.get_component(0).evaluate_to_constant(),i.get_component(1).evaluate_to_constant()]}catch{a=[NaN,NaN]}if(B.current=a,e.current===null)K();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),S.current.coords.setCoordinates(JXG.COORDS_BY_USER,a),e.current.setText(r.value);let i=!r.hidden;if(Number.isFinite(a[0])&&Number.isFinite(a[1])){let o=e.current.visProp.visible!==i;e.current.visProp.visible=i,e.current.visPropCalc.visible=i,o&&e.current.setAttribute({visible:i})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let b=10*r.layer+H;e.current.visProp.layer!==b&&e.current.setAttribute({layer:b});let c=C==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,k=C==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,x="";if(k?x+=`background-color: ${k}`:x+="background-color: transparent",e.current.visProp.strokecolor!==c&&(e.current.visProp.strokecolor=c,e.current.visProp.highlightstrokecolor=c),e.current.visProp.cssstyle!==x&&(e.current.visProp.cssstyle=x,e.current.visProp.highlightcssstyle=x),e.current.visProp.highlight=!v.current,e.current.visProp.fixed=m.current,e.current.isDraggable=!v.current,e.current.needsUpdate=!0,r.positionFromAnchor!==E.current){let{anchorx:o,anchory:t}=I(r.positionFromAnchor);e.current.visProp.anchorx=o,e.current.visProp.anchory=t,P.current=[o,t],E.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();S.current.needsUpdate=!0,S.current.update(),n.updateRenderer()}return F.jsx("a",{name:D})}if(r.hidden)return null;let Z=ae(C,r.selectedStyle),J=r.value;return r.hasLatex&&(J=F.jsx(ie,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:J})),F.jsxs("span",{id:D,style:Z,children:[F.jsx("a",{name:D}),J]})});export{xe as default};
