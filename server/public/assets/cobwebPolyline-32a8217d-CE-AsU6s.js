import{R as V,u as L,r as a,i as A,a as w}from"./index-CrSqH__w.js";import{BoardContext as U,LINE_LAYER_OFFSET as R,VERTEX_LAYER_OFFSET as Y}from"./graph-5fd7c87e-CqVNngzu.js";import"./css-5483d03f-CnY6i4xu.js";const T=V.memo(function h(D){let{name:_,id:G,SVs:e,actions:P,sourceOfUpdate:x,callAction:C}=L(D);h.ignoreActionsWithoutCore=()=>!0;const i=a.useContext(U);let p=a.useRef(null),k=a.useRef(null),u=a.useRef(null),t=a.useRef(null),g=a.useRef(null),d=a.useRef(null),y=a.useRef(null),m=a.useRef(null),$=a.useRef(null);$.current=e.numericalVertices,a.useEffect(()=>()=>{u.current&&J()},[]);function I(){let n={visible:!e.hidden,withLabel:!1,fixed:!0,layer:10*e.layer+R,strokeColor:"green",highlightStrokeColor:"green",strokeWidth:3,dash:E("solid")},s=A(e.fDefinition);p.current=i.create("functiongraph",[s],n);let S={visible:!e.hidden,withLabel:!1,fixed:!0,layer:10*e.layer+R,strokeColor:"gray",highlightStrokeColor:"gray",strokeWidth:2,dash:E("solid")};k.current=i.create("line",[[0,0],[1,1]],S);let v={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:!0,layer:10*e.layer+R,strokeColor:e.selectedStyle.lineColor,highlightStrokeColor:e.selectedStyle.lineColor,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:E(e.selectedStyle.lineStyle)};v.label={highlight:!1},e.labelHasLatex&&(v.label.useMathJax=!0),m.current={fixed:!e.draggable||e.fixed,visible:!e.hidden&&e.draggable,withLabel:!0,name:"A",layer:10*e.layer+Y,fillColor:e.selectedStyle.markerColor,strokeColor:e.selectedStyle.markerColor,size:e.selectedStyle.markerSize,face:W(e.selectedStyle.markerStyle)},e.draggable?(m.current.highlightFillColor="#EEEEEE",m.current.highlightStrokeColor="#C3D9FF",m.current.showInfoBox=!0):(m.current.highlightFillColor=e.selectedStyle.markerColor,m.current.highlightStrokeColor=e.selectedStyle.markerColor,m.current.showInfoBox=!1),t.current=[];let f=e.variable.toString();for(let o=0;o<e.numPoints;o++){let c=Object.assign({},m.current);o===0?c.name=`(${f}_0,0)`:o%2===1?c.name=`(${f}_{${(o-1)/2}}, ${f}_{${(o+1)/2}})`:c.name=`(${f}_{${o/2}}, ${f}_{${o/2}})`,o!==e.numPoints-1&&(c.visible=!1),t.current.push(i.create("point",[...e.numericalVertices[o]],c))}let r=[],l=[];e.numericalVertices.forEach(o=>{r.push(o[0]),l.push(o[1])});let b=i.create("curve",[r,l],v);for(let o=0;o<e.numPoints;o++)t.current[o].on("drag",c=>F(o,c)),t.current[o].on("up",c=>O(o)),t.current[o].on("keyfocusout",()=>X(o)),t.current[o].on("keydown",c=>j(o,c)),t.current[o].on("down",c=>d.current=null);return y.current=e.numPoints,b}function J(){i.removeObject(u.current),u.current=null,i.removeObject(p.current),p.current=null,i.removeObject(k.current),k.current=null;for(let n=0;n<e.numPoints;n++)t.current[n]&&(t.current[n].off("drag"),t.current[n].off("up"),t.current[n].off("keyfocusout"),t.current[n].off("keydown"),t.current[n].off("down"),i.removeObject(t.current[n]),delete t.current[n])}function F(n,s){s.type,d.current=n,g.current={},g.current[n]=[t.current[n].X(),t.current[n].Y()],C({action:P.movePolyline,args:{pointCoords:g.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),t.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...$.current[n]]),i.updateInfobox(t.current[n])}function O(n){d.current===n&&C({action:P.movePolyline,args:{pointCoords:g.current,sourceDetails:{vertex:n}}})}function X(n){if(d.current!==n){d.current=null;return}d.current=null,C({action:P.movePolyline,args:{pointCoords:g.current,sourceInformation:{vertex:n}}})}function j(n,s){s.key==="Enter"&&(d.current===n&&C({action:P.movePolyline,args:{pointCoords:g.current,sourceInformation:{vertex:n}}}),d.current=null)}if(i)if(!u.current)u.current=I();else{let n=A(e.fDefinition);p.current.Y=n,p.current.needsUpdate=!0,p.current.updateCurve();let s=e.variable.toString();if(e.numPoints>y.current)for(let r=y.current;r<e.numPoints;r++){let l=Object.assign({},m.current);r===0?l.name=`(${s}_0,0)`:r%2===1?l.name=`(${s}_{${(r-1)/2}}, ${s}_{${(r+1)/2}})`:l.name=`(${s}_{${r/2}}, ${s}_{${r/2}})`,r!==e.numPoints-1&&(l.visible=!1),t.current.push(i.create("point",[...e.numericalVertices[r]],l)),t.current[r].on("drag",b=>F(r,b)),t.current[r].on("up",b=>O(r)),t.current[r].on("keyfocusout",()=>X(r)),t.current[r].on("keydown",b=>j(r,b)),t.current[r].on("down",b=>d.current=null)}else if(e.numPoints<y.current){for(let r=e.numPoints;r<y.current;r++){let l=t.current.pop();l.off("drag"),l.off("up"),l.off("keyfocusout"),l.off("keydown"),l.off("down"),console.log("about to remove",l),i.removeObject(l),i.update()}u.current.dataX.length=e.numPoints}y.current=e.numPoints;let S=u.current.transformMat[1][0],v=u.current.transformMat[2][0];for(let r=0;r<e.numPoints;r++)t.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[r]]),u.current.dataX[r]=e.numericalVertices[r][0]-S,u.current.dataY[r]=e.numericalVertices[r][1]-v;let f=!e.hidden;u.current.visProp.visible=f,u.current.visPropCalc.visible=f;for(let r=0;r<e.numPoints-1;r++)t.current[r].visProp.visible=!1,t.current[r].visPropCalc.visible=!1;if(e.numPoints>0&&e.draggable&&(t.current[e.numPoints-1].visProp.visible=f,t.current[e.numPoints-1].visPropCalc.visible=f),x.sourceInformation&&_ in x.sourceInformation){let r=x.sourceInformation[_].vertex;Number.isFinite(r)&&i.updateInfobox(t.current[r])}u.current.needsUpdate=!0,u.current.update().updateVisibility();for(let r=0;r<e.numPoints;r++)t.current[r].needsUpdate=!0,t.current[r].update();e.numPoints>0&&(t.current[e.numPoints-1].setAttribute({withlabel:!0}),t.current[e.numPoints-1].label.needsUpdate=!0,t.current[e.numPoints-1].label.update()),i.updateRenderer()}return e.hidden?null:w.jsx(w.Fragment,{children:w.jsx("a",{name:G})})});function E(h){return h==="solid"?0:h==="dashed"?2:h==="dotted"?1:0}function W(h){return h==="triangle"?"triangleup":h}export{T as default};
