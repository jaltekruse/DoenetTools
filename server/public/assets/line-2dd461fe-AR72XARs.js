import{R as H,u as N,r as o,P as I,a as b,ag as V,M as $}from"./index-CrSqH__w.js";import{BoardContext as q,LINE_LAYER_OFFSET as j}from"./graph-5fd7c87e-CqVNngzu.js";import"./css-5483d03f-CnY6i4xu.js";const Z=H.memo(function x(R){var M;let{name:v,id:L,SVs:e,actions:s,callAction:c}=N(R);x.ignoreActionsWithoutCore=()=>!0;const a=o.useContext(q);let t=o.useRef({}),g=o.useRef(null),S=o.useRef(null),w=o.useRef(!1),O=o.useRef(!1),h=o.useRef(!1),D=o.useRef(null),E=o.useRef(null),u=o.useRef(null),F=o.useRef(null),C=o.useRef(!1),k=o.useRef(!1),_=o.useRef(!1);F.current=e.numericalPoints,C.current=e.fixed,k.current=!e.draggable||e.fixLocation||e.fixed,_.current=e.switchable&&!e.fixed;const{darkMode:G}=o.useContext(I)||{};o.useEffect(()=>()=>{Object.keys(t.current).length!==0&&X(),a&&a.off("move",J)},[]),o.useEffect(()=>{a&&a.on("move",J)},[a]);function W(){var f;if(((f=e.numericalPoints)==null?void 0:f.length)!==2||e.numericalPoints.some(r=>r.length!==2)){t.current={};return}let y=e.labelForGraph!=="",P=G==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var p={name:e.labelForGraph,visible:!e.hidden,withlabel:y,fixed:C.current,layer:10*e.layer+j,strokeColor:P,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:P,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:A(e.selectedStyle.lineStyle,e.dashed),highlight:!k.current};if(y){let r,n,l;e.labelPosition==="upperright"?(l=[5,5],r="left",n="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],r="right",n="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],r="left",n="top"):(l=[-5,-5],r="right",n="top"),p.label={offset:l,anchorx:r,anchory:n,position:"top",highlight:!1},e.labelHasLatex&&(p.label.useMathJax=!0),e.applyStyleToLabel?p.label.strokeColor=P:p.label.strokeColor="var(--canvastext)"}else p.label={highlight:!1},e.labelHasLatex&&(p.label.useMathJax=!0);let m=[[...e.numericalPoints[0]],[...e.numericalPoints[1]]],i=a.create("line",m,p);i.isDraggable=!k.current,i.on("drag",function(r){let n=r.type==="pointermove";if((!n||Math.abs(r.x-g.current[0])>.1||Math.abs(r.y-g.current[1])>.1)&&(h.current=!0),u.current=[],n){var l=a.origin.scrCoords;for(let d=0;d<2;d++){let B=(S.current[d][1]+r.x-g.current[0]-l[1])/a.unitX,T=(l[2]-(S.current[d][2]+r.y-g.current[1]))/a.unitY;u.current.push([B,T])}}else u.current.push([i.point1.X(),i.point1.Y()]),u.current.push([i.point2.X(),i.point2.Y()]);c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1],transient:!0,skippable:!0}}),i.point1.coords.setCoordinates(JXG.COORDS_BY_USER,F.current[0]),i.point2.coords.setCoordinates(JXG.COORDS_BY_USER,F.current[1])}),i.on("up",function(r){h.current?c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}):!O.current&&!C.current&&(_.current?(c({action:s.switchLine}),c({action:s.lineClicked,args:{name:v}})):c({action:s.lineClicked,args:{name:v}})),w.current=!1}),i.on("keyfocusout",function(r){h.current&&(c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}),h.current=!1)}),i.on("down",function(r){h.current=!1,g.current=[r.x,r.y],S.current=[[...i.point1.coords.scrCoords],[...i.point2.coords.scrCoords]],w.current=!0,O.current=!1,C.current||c({action:s.lineFocused,args:{name:v}})}),i.on("hit",function(r){h.current=!1,S.current=[[...i.point1.coords.scrCoords],[...i.point2.coords.scrCoords]],c({action:s.lineFocused,args:{name:v}})}),i.on("keydown",function(r){r.key==="Enter"&&(h.current&&(c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}),h.current=!1),_.current?(c({action:s.switchLine}),c({action:s.lineClicked,args:{name:v}})):c({action:s.lineClicked,args:{name:v}}))}),D.current=e.labelForGraph!=="",t.current=i}function J(f){w.current&&(Math.abs(f.x-g.current[0])>.1||Math.abs(f.y-g.current[1])>.1)&&(O.current=!0)}function X(){t.current.off("drag"),t.current.off("down"),t.current.off("hit"),t.current.off("up"),t.current.off("keyfocusout"),t.current.off("keydown"),a.removeObject(t.current),t.current={}}if(a){if(Object.keys(t.current).length===0)W();else if(((M=e.numericalPoints)==null?void 0:M.length)!==2||e.numericalPoints.some(f=>f.length!==2))X();else{let f=!0;for(let n of[e.numericalPoints[0],e.numericalPoints[1]])Number.isFinite(n[0])||(f=!1),Number.isFinite(n[1])||(f=!1);t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[1]);let y=!e.hidden;if(f){let n=t.current.visProp.visible!==y;t.current.visProp.visible=y,t.current.visPropCalc.visible=y,n&&t.current.setAttribute({visible:y})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;t.current.visProp.fixed=C.current,t.current.visProp.highlight=!k.current,t.current.isDraggable=!k.current;let P=10*e.layer+j;t.current.visProp.layer!==P&&t.current.setAttribute({layer:P});let m=G==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;t.current.visProp.strokecolor!==m&&(t.current.visProp.strokecolor=m,t.current.visProp.highlightstrokecolor=m),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let i=A(e.selectedStyle.lineStyle,e.dashed);t.current.visProp.dash!==i&&(t.current.visProp.dash=i),t.current.name=e.labelForGraph;let r=e.labelForGraph!=="";if(r!=D.current&&(t.current.setAttribute({withlabel:r}),D.current=r),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=m:t.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==E.current){let n,l,d;e.labelPosition==="upperright"?(d=[5,5],n="left",l="bottom"):e.labelPosition==="upperleft"?(d=[-5,5],n="right",l="bottom"):e.labelPosition==="lowerright"?(d=[5,-5],n="left",l="top"):(d=[-5,-5],n="right",l="top"),t.current.label.visProp.anchorx=n,t.current.label.visProp.anchory=l,t.current.label.visProp.offset=d,E.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();a.updateRenderer()}return b.jsx(b.Fragment,{children:b.jsx("a",{name:L})})}if(e.hidden)return null;let Y="\\("+e.latex+"\\)",U=V(G,e.selectedStyle);return b.jsxs(b.Fragment,{children:[b.jsx("a",{name:L}),b.jsx("span",{id:L,style:U,children:b.jsx($,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:Y})})]})});function A(x,R){return x==="dashed"||R?2:x==="solid"?0:x==="dotted"?1:0}export{Z as default};
