import{R as ne,u as oe,r as o,P as ce,C as z,a as R,ag as se}from"./index-CrSqH__w.js";import{BoardContext as ie,TEXT_LAYER_OFFSET as V}from"./graph-5fd7c87e-CqVNngzu.js";import{g as H}from"./graph-462f764a-C0kM6xFY.js";import"./css-5483d03f-CnY6i4xu.js";const he=ne.memo(function I(W){let{name:S,id:M,SVs:t,actions:a,sourceOfUpdate:le,callAction:d}=oe(W);I.ignoreActionsWithoutCore=()=>!0;let e=o.useRef(null),P=o.useRef(null),_=o.useRef(null);const c=o.useContext(ie);let y=o.useRef(null),A=o.useRef(null),X=o.useRef(!1),O=o.useRef(!1),u=o.useRef(!1),f=o.useRef(null),h=o.useRef(null),B=o.useRef(null),T=o.useRef(null),C=o.useRef(!1),v=o.useRef(!1);C.current=t.fixed,v.current=!t.draggable||t.fixLocation||t.fixed;const{darkMode:b}=o.useContext(ce)||{};o.useEffect(()=>()=>{e.current!==null&&K(),c&&c.off("move",N)},[]),o.useEffect(()=>{c&&c.on("move",N)},[c]);function q(){let i=b==="dark"?t.selectedStyle.textColorDarkMode:t.selectedStyle.textColor,l=b==="dark"?t.selectedStyle.backgroundColorDarkMode:t.selectedStyle.backgroundColor,m="";l&&(m+=`background-color: ${l}`);let x={visible:!t.hidden,fixed:C.current,layer:10*t.layer+V,cssStyle:m,highlightCssStyle:m,strokeColor:i,strokeOpacity:1,highlightStrokeColor:i,highlightStrokeOpacity:.5,highlight:!v.current,parse:!1},s;try{let r=z.fromAst(t.anchor),p=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()];Number.isFinite(p[0])||(p[0]=0,x.visible=!1),Number.isFinite(p[1])||(p[1]=0,x.visible=!1),s=c.create("point",p,{visible:!1})}catch{x.visible=!1,s=c.create("point",[0,0],{visible:!1})}x.anchor=s;let{anchorx:k,anchory:g}=H(t.positionFromAnchor);x.anchorx=k,x.anchory=g,_.current=[k,g];let n=c.create("text",[0,0,t.text],x);n.isDraggable=!v.current,n.on("down",function(r){y.current=[r.x,r.y],A.current=[...s.coords.scrCoords],u.current=!1,X.current=!0,O.current=!1,C.current||d({action:a.textFocused,args:{name:S}})}),n.on("hit",function(r){A.current=[...s.coords.scrCoords],u.current=!1,d({action:a.textFocused,args:{name:S}})}),n.on("up",function(r){u.current?(d({action:a.moveText,args:{x:f.current,y:h.current}}),u.current=!1):!O.current&&!C.current&&d({action:a.textClicked,args:{name:S}}),X.current=!1}),n.on("keyfocusout",function(r){u.current&&(d({action:a.moveText,args:{x:f.current,y:h.current}}),u.current=!1)}),n.on("drag",function(r){let p=r.type==="pointermove";(!p||Math.abs(r.x-y.current[0])>.1||Math.abs(r.y-y.current[1])>.1)&&(u.current=!0);let[E,j,w,G]=c.getBoundingBox(),J=n.size[0]/c.unitX,Y=n.size[1]/c.unitY,U=_.current[0],L=_.current[1],F=0;U==="middle"?F=-J/2:U==="right"&&(F=-J);let D=0;L==="middle"?D=-Y/2:L==="top"&&(D=-Y);let Z=E+.04*(w-E)-F-J,ee=w-.04*(w-E)-F,te=G+.04*(j-G)-D-Y,re=j-.04*(j-G)-D;if(p){var $=c.origin.scrCoords;f.current=(A.current[1]+r.x-y.current[0]-$[1])/c.unitX,h.current=($[2]-(A.current[2]+r.y-y.current[1]))/c.unitY}else f.current=s.X()+n.relativeCoords.usrCoords[1],h.current=s.Y()+n.relativeCoords.usrCoords[2];f.current=Math.min(ee,Math.max(Z,f.current)),h.current=Math.min(re,Math.max(te,h.current)),d({action:a.moveText,args:{x:f.current,y:h.current,transient:!0,skippable:!0}}),n.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,B.current)}),n.on("keydown",function(r){r.key==="Enter"&&(u.current&&(d({action:a.moveText,args:{x:f.current,y:h.current}}),u.current=!1),d({action:a.textClicked,args:{name:S}}))}),e.current=n,P.current=s,T.current=t.positionFromAnchor}function N(i){X.current&&(Math.abs(i.x-y.current[0])>.1||Math.abs(i.y-y.current[1])>.1)&&(O.current=!0)}function K(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),c.removeObject(e.current),e.current=null}if(c){let i;try{let l=z.fromAst(t.anchor);i=[l.get_component(0).evaluate_to_constant(),l.get_component(1).evaluate_to_constant()]}catch{i=[NaN,NaN]}if(B.current=i,e.current===null)q();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),P.current.coords.setCoordinates(JXG.COORDS_BY_USER,i),e.current.setText(t.text);let l=!t.hidden;if(Number.isFinite(i[0])&&Number.isFinite(i[1])){let n=e.current.visProp.visible!==l;e.current.visProp.visible=l,e.current.visPropCalc.visible=l,n&&e.current.setAttribute({visible:l})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let m=10*t.layer+V;e.current.visProp.layer!==m&&e.current.setAttribute({layer:m});let s=b==="dark"?t.selectedStyle.textColorDarkMode:t.selectedStyle.textColor,k=b==="dark"?t.selectedStyle.backgroundColorDarkMode:t.selectedStyle.backgroundColor,g="";if(k?g+=`background-color: ${k}`:g+="background-color: transparent",e.current.visProp.strokecolor!==s&&(e.current.visProp.strokecolor=s,e.current.visProp.highlightstrokecolor=s),e.current.visProp.cssstyle!==g&&(e.current.visProp.cssstyle=g,e.current.visProp.highlightcssstyle=g),e.current.visProp.highlight=!v.current,e.current.visProp.fixed=C.current,e.current.isDraggable=!v.current,e.current.needsUpdate=!0,t.positionFromAnchor!==T.current){let{anchorx:n,anchory:r}=H(t.positionFromAnchor);e.current.visProp.anchorx=n,e.current.visProp.anchory=r,_.current=[n,r],T.current=t.positionFromAnchor,e.current.fullUpdate()}else e.current.update();P.current.needsUpdate=!0,P.current.update(),c.updateRenderer()}return R.jsx("a",{name:M})}if(t.hidden)return null;let Q=se(b,t.selectedStyle);return R.jsxs(R.Fragment,{children:[R.jsx("a",{name:M}),R.jsx("span",{id:M,style:Q,children:t.text})]})});export{he as default};
