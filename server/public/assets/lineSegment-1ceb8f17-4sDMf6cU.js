import{R as H,u as N,r as f,P as $,a as w}from"./index-DVZ7nus4.js";import{BoardContext as q,LINE_LAYER_OFFSET as U,VERTEX_LAYER_OFFSET as I}from"./graph-1a05b976-BUHOs_UM.js";import"./css-5483d03f-CnY6i4xu.js";const Z=H.memo(function R(T){let{name:h,id:W,SVs:r,actions:i,sourceOfUpdate:F,callAction:l}=N(T);R.ignoreActionsWithoutCore=()=>!0;const u=f.useContext(q);let e=f.useRef(null),n=f.useRef(null),o=f.useRef(null),m=f.useRef(null),X=f.useRef(null),S=f.useRef(!1),k=f.useRef(!1),c=f.useRef(null),G=f.useRef(null),_=f.useRef(null),s=f.useRef(null),P=f.useRef(null),A=f.useRef(null),C=f.useRef(!1),E=f.useRef(!1),L=f.useRef(!1);A.current=r.numericalEndpoints,C.current=r.fixed,E.current=!r.draggable||r.fixLocation||r.fixed,L.current=!r.endpointsDraggable||r.fixed||r.fixLocation;const{darkMode:Y}=f.useContext($)||{};f.useEffect(()=>()=>{e.current&&M(),u&&u.off("move",J)},[]),f.useEffect(()=>{u&&u.on("move",J)},[u]);function V(){if(r.numericalEndpoints.length!==2||r.numericalEndpoints.some(t=>t.length!==2)){e.current=null,n.current=null,o.current=null;return}let a=r.labelForGraph!=="",g=Y==="dark"?r.selectedStyle.lineColorDarkMode:r.selectedStyle.lineColor;var p={name:r.labelForGraph,visible:!r.hidden,withlabel:a,fixed:C.current,layer:10*r.layer+U,strokeColor:g,strokeOpacity:r.selectedStyle.lineOpacity,highlightStrokeColor:g,highlightStrokeOpacity:r.selectedStyle.lineOpacity*.5,strokeWidth:r.selectedStyle.lineWidth,highlightStrokeWidth:r.selectedStyle.lineWidth,dash:B(r.selectedStyle.lineStyle),highlight:!E.current};if(a){let t,v,d;r.labelPosition==="upperright"?(d=[5,5],t="left",v="bottom"):r.labelPosition==="upperleft"?(d=[-5,5],t="right",v="bottom"):r.labelPosition==="lowerright"?(d=[5,-5],t="left",v="top"):(d=[-5,-5],t="right",v="top"),p.label={offset:d,anchorx:t,anchory:v,highlight:!1},r.labelHasLatex&&(p.label.useMathJax=!0),r.applyStyleToLabel?p.label.strokeColor=g:p.label.strokeColor="var(--canvastext)"}else p.label={highlight:!1},r.labelHasLatex&&(p.label.useMathJax=!0);let x=!L.current&&!r.hidden,b=Object.assign({},p);Object.assign(b,{withLabel:!1,fixed:!1,highlight:!0,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*r.layer+I,showInfoBox:r.showCoordsWhenDragging,visible:x});let y=[[...r.numericalEndpoints[0]],[...r.numericalEndpoints[1]]];return n.current=u.create("point",y[0],b),o.current=u.create("point",y[1],b),e.current=u.create("segment",[n.current,o.current],p),e.isDraggable=!E.current,n.current.on("drag",t=>j(1,t)),o.current.on("drag",t=>j(2,t)),e.current.on("drag",t=>j(0,t)),n.current.on("up",()=>{c.current===1?l({action:i.moveLineSegment,args:{point1coords:s.current}}):!k.current&&!C.current&&l({action:i.lineSegmentClicked,args:{name:h}}),P.current=null,S.current=!1}),o.current.on("up",()=>{c.current===2?l({action:i.moveLineSegment,args:{point2coords:s.current}}):!k.current&&!C.current&&l({action:i.lineSegmentClicked,args:{name:h}}),P.current=null,S.current=!1}),e.current.on("up",function(t){c.current===0?l({action:i.moveLineSegment,args:{point1coords:s.current[0],point2coords:s.current[1]}}):!k.current&&P.current===null&&!C.current&&l({action:i.lineSegmentClicked,args:{name:h}}),S.current=!1}),n.current.on("keyfocusout",()=>{c.current===1&&l({action:i.moveLineSegment,args:{point1coords:s.current}}),c.current=null}),o.current.on("keyfocusout",()=>{c.current===2&&l({action:i.moveLineSegment,args:{point2coords:s.current}}),c.current=null}),e.current.on("keyfocusout",function(t){c.current===0&&l({action:i.moveLineSegment,args:{point1coords:s.current[0],point2coords:s.current[1]}}),c.current=null}),n.current.on("down",t=>{c.current=null,m.current=[t.x,t.y],P.current=1,S.current=!0,k.current=!1,L.current||l({action:i.lineSegmentFocused,args:{name:h}})}),n.current.on("hit",t=>{c.current=null,l({action:i.lineSegmentFocused,args:{name:h}})}),o.current.on("down",t=>{c.current=null,m.current=[t.x,t.y],P.current=2,S.current=!0,k.current=!1,L.current||l({action:i.lineSegmentFocused,args:{name:h}})}),o.current.on("hit",t=>{c.current=null,l({action:i.lineSegmentFocused,args:{name:h}})}),e.current.on("down",function(t){c.current=null,m.current=[t.x,t.y],X.current=[[...n.current.coords.scrCoords],[...o.current.coords.scrCoords]],S.current=!0,k.current=!1,P.current===null&&!C.current&&l({action:i.lineSegmentFocused,args:{name:h}})}),e.current.on("hit",t=>{c.current=null,l({action:i.lineSegmentFocused,args:{name:h}})}),n.current.on("keydown",function(t){t.key==="Enter"&&(c.current===1&&l({action:i.moveLineSegment,args:{point1coords:s.current}}),c.current=null,l({action:i.lineSegmentClicked,args:{name:h}}))}),o.current.on("keydown",function(t){t.key==="Enter"&&(c.current===2&&l({action:i.moveLineSegment,args:{point2coords:s.current}}),c.current=null,l({action:i.lineSegmentClicked,args:{name:h}}))}),e.current.on("keydown",function(t){t.key==="Enter"&&(c.current===0&&l({action:i.moveLineSegment,args:{point1coords:s.current[0],point2coords:s.current[1]}}),c.current=null,l({action:i.lineSegmentClicked,args:{name:h}}))}),_.current=r.labelPosition,G.current=a,e.current}function J(a){S.current&&(Math.abs(a.x-m.current[0])>.1||Math.abs(a.y-m.current[1])>.1)&&(k.current=!0)}function j(a,g){let p=g.type==="pointermove";if(!p||Math.abs(g.x-m.current[0])>.1||Math.abs(g.y-m.current[1])>.1)if(c.current=a,a==1)s.current=[e.current.point1.X(),e.current.point1.Y()],l({action:i.moveLineSegment,args:{point1coords:s.current,transient:!0,skippable:!0,sourceDetails:{endpoint:a}}});else if(a==2)s.current=[e.current.point2.X(),e.current.point2.Y()],l({action:i.moveLineSegment,args:{point2coords:s.current,transient:!0,skippable:!0,sourceDetails:{endpoint:a}}});else{if(s.current=[],p){var x=u.origin.scrCoords;for(let b=0;b<2;b++){let y=(X.current[b][1]+g.x-m.current[0]-x[1])/u.unitX,t=(x[2]-(X.current[b][2]+g.y-m.current[1]))/u.unitY;s.current.push([y,t])}}else s.current.push([e.current.point1.X(),e.current.point1.Y()]),s.current.push([e.current.point2.X(),e.current.point2.Y()]);l({action:i.moveLineSegment,args:{point1coords:s.current[0],point2coords:s.current[1],transient:!0,skippable:!0}})}e.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,A.current[0]),e.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,A.current[1]),a==1?u.updateInfobox(e.current.point1):a==2&&u.updateInfobox(e.current.point2)}function M(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keydown"),e.current.off("keyfocusout"),u.removeObject(e.current),e.current=null,n.current.off("drag"),n.current.off("down"),n.current.off("hit"),n.current.off("up"),n.current.off("keydown"),n.current.off("keyfocusout"),u.removeObject(n.current),n.current=null,o.current.off("drag"),o.current.off("down"),o.current.off("hit"),o.current.off("up"),o.current.off("keydown"),o.current.off("keyfocusout"),u.removeObject(o.current),o.current=null}if(u){if(e.current===null)V();else if(r.numericalEndpoints.length!==2||r.numericalEndpoints.some(a=>a.length!==2))M();else{let a=!0;for(let d of[r.numericalEndpoints[0],r.numericalEndpoints[1]])Number.isFinite(d[0])||(a=!1),Number.isFinite(d[1])||(a=!1);if(e.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,r.numericalEndpoints[0]),e.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,r.numericalEndpoints[1]),F.sourceInformation&&h in F.sourceInformation){let d=F.sourceInformation[h].endpoint;d===1?u.updateInfobox(e.current.point1):d===2&&u.updateInfobox(e.current.point2)}let g=!r.hidden&&a;if(a){let d=e.current.visProp.visible!==g;e.current.visProp.visible=g,e.current.visPropCalc.visible=g,d&&e.current.setAttribute({visible:g})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let p=!L.current&&g;n.current.visProp.visible=p,n.current.visPropCalc.visible=p,o.current.visProp.visible=p,o.current.visPropCalc.visible=p,n.current.visProp.showinfobox=r.showCoordsWhenDragging,o.current.visProp.showinfobox=r.showCoordsWhenDragging,e.current.visProp.fixed=C.current,e.current.visProp.highlight=!E.current,e.current.isDraggable=!E.current;let x=10*r.layer+U;e.current.visProp.layer!==x&&(e.current.setAttribute({layer:x}),n.current.setAttribute({layer:10*r.layer+I}),o.current.setAttribute({layer:10*r.layer+I}));let y=Y==="dark"?r.selectedStyle.lineColorDarkMode:r.selectedStyle.lineColor;e.current.visProp.strokecolor!==y&&(e.current.visProp.strokecolor=y,e.current.visProp.highlightstrokecolor=y),e.current.visProp.strokewidth!==r.selectedStyle.lineWidth&&(e.current.visProp.strokewidth=r.selectedStyle.lineWidth,e.current.visProp.highlightstrokewidth=r.selectedStyle.lineWidth),e.current.visProp.strokeopacity!==r.selectedStyle.lineOpacity&&(e.current.visProp.strokeopacity=r.selectedStyle.lineOpacity,e.current.visProp.highlightstrokeopacity=r.selectedStyle.lineOpacity*.5);let t=B(r.selectedStyle.lineStyle);e.current.visProp.dash!==t&&(e.current.visProp.dash=t),e.current.name=r.labelForGraph;let v=r.labelForGraph!=="";if(v!=G.current&&(e.current.setAttribute({withlabel:v}),G.current=v),n.current.highlighted?u.updateInfobox(n.current):o.current.highlighted&&u.updateInfobox(o.current),e.current.needsUpdate=!0,e.current.update(),e.current.hasLabel)if(e.current.label.needsUpdate=!0,r.applyStyleToLabel?e.current.label.visProp.strokecolor=y:e.current.label.visProp.strokecolor="var(--canvastext)",r.labelPosition!==_.current){let d,O,D;r.labelPosition==="upperright"?(D=[5,5],d="left",O="bottom"):r.labelPosition==="upperleft"?(D=[-5,5],d="right",O="bottom"):r.labelPosition==="lowerright"?(D=[5,-5],d="left",O="top"):(D=[-5,-5],d="right",O="top"),e.current.label.visProp.anchorx=d,e.current.label.visProp.anchory=O,e.current.label.visProp.offset=D,_.current=r.labelPosition,e.current.label.fullUpdate()}else e.current.label.update();n.current.needsUpdate=!0,n.current.update(),o.current.needsUpdate=!0,o.current.update(),u.updateRenderer()}return w.jsx(w.Fragment,{children:w.jsx("a",{name:W})})}return r.hidden?null:w.jsx(w.Fragment,{children:w.jsx("a",{name:W})})});function B(R){return R==="solid"?0:R==="dashed"?2:R==="dotted"?1:0}export{Z as default};
