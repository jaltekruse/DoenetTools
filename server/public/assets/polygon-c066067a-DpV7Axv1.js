import{R as ee,u as re,r as u,P as te,a as _}from"./index-CrSqH__w.js";import{BoardContext as oe,LINE_LAYER_OFFSET as A,VERTEX_LAYER_OFFSET as $}from"./graph-5fd7c87e-CqVNngzu.js";import"./css-5483d03f-CnY6i4xu.js";const se=ee.memo(function S(K){let{name:b,id:Q,SVs:e,actions:p,sourceOfUpdate:E,callAction:h}=re(K);S.ignoreActionsWithoutCore=()=>!0;const a=u.useContext(oe);let r=u.useRef(null),v=u.useRef(null),g=u.useRef(null),V=u.useRef(null),P=u.useRef(null),L=u.useRef(null),I=u.useRef(!1),U=u.useRef(!1),m=u.useRef(null),w=u.useRef(null),M=u.useRef(null),R=u.useRef(!1),O=u.useRef(!1),C=u.useRef(!1),x=u.useRef([]);M.current=e.numericalVertices,R.current=e.fixed,O.current=!e.draggable||e.fixLocation||e.fixed,C.current=!e.verticesDraggable||e.fixed||e.fixLocation,x.current=e.vertexIndicesDraggable;const{darkMode:D}=u.useContext(te)||{};u.useEffect(()=>()=>{r.current&&W(),a&&a.off("move",G)},[]),u.useEffect(()=>{a&&a.on("move",G)},[a]);function Z(){if(!(e.numVertices>=2))return null;let t=D==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,o=D==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;o=e.filled?o:"none",w.current={fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:"black",visible:!C.current&&!e.hidden,withLabel:!1,layer:10*e.layer+$,highlight:!0,showInfoBox:e.showCoordsWhenDragging};let i={highlight:!1,visible:!e.hidden,layer:10*e.layer+A,fixed:!0,strokeColor:t,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:t,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:q(e.selectedStyle.lineStyle)},s={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:R.current,layer:10*e.layer+A,fillColor:o,fillOpacity:e.selectedStyle.fillOpacity,highlightFillColor:o,highlightFillOpacity:e.selectedStyle.fillOpacity*.5,highlight:!O.current,vertices:w.current,borders:i};s.label={highlight:!1},e.labelHasLatex&&(s.label.useMathJax=!0),e.applyStyleToLabel?s.label.strokeColor=t:s.label.strokeColor="var(--canvastext)",e.filled&&(s.hasInnerPoints=!0),a.suspendUpdate();let d=[];for(let[f,k]of e.numericalVertices.entries()){let y={...w.current};x.current.includes(f)||(y.visible=!1),d.push(a.create("point",[...k],y))}let c=a.create("polygon",d,s);return c.isDraggable=!O.current,X(c),c.on("drag",f=>H(-1,f)),c.on("up",f=>J(-1)),c.on("keyfocusout",f=>B(-1)),c.on("keydown",f=>T(-1,f)),c.on("down",f=>Y(-1,f)),c.on("hit",f=>j()),c.on("over",f=>{N()}),c.on("out",f=>{z()}),a.unsuspendUpdate(),m.current=e.numVertices,c}function G(t){I.current&&(Math.abs(t.x-P.current[0])>.1||Math.abs(t.y-P.current[1])>.1)&&(U.current=!0)}function X(t){for(let o=0;o<e.numVertices;o++){let i=t.vertices[o];i.off("drag"),i.on("drag",s=>H(o,s)),i.off("up"),i.on("up",()=>J(o)),i.off("keyfocusout"),i.on("keyfocusout",()=>B(o)),i.off("keydown"),i.on("keydown",s=>T(o,s)),i.off("down"),i.on("down",s=>Y(o,s)),i.off("hit"),i.on("hit",s=>j())}}function W(){for(let t=0;t<e.numVertices;t++){let o=r.current.vertices[t];o&&(o.off("drag"),o.off("up"),o.off("down"),o.off("hit"))}r.current.off("drag"),r.current.off("up"),r.current.off("down"),r.current.off("hit"),a.removeObject(r.current),r.current=null}function H(t,o){let i=o.type==="pointermove";if(!i||Math.abs(o.x-P.current[0])>.1||Math.abs(o.y-P.current[1])>.1)if(g.current=t,t===-1){v.current=[];var s=a.origin.scrCoords;for(let d=0;d<r.current.vertices.length-1;d++)if(i){let c=(L.current[d][1]+o.x-P.current[0]-s[1])/a.unitX,f=(s[2]-(L.current[d][2]+o.y-P.current[1]))/a.unitY;v.current.push([c,f])}else{let c=r.current.vertices[d];v.current.push([c.X(),c.Y()])}h({action:p.movePolygon,args:{pointCoords:v.current,transient:!0,skippable:!0}});for(let d=0;d<e.numVertices;d++)r.current.vertices[d].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[d]])}else v.current={},v.current[t]=[r.current.vertices[t].X(),r.current.vertices[t].Y()],h({action:p.movePolygon,args:{pointCoords:v.current,transient:!0,skippable:!0,sourceDetails:{vertex:t}}}),r.current.vertices[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[t]]),a.updateInfobox(r.current.vertices[t])}function Y(t,o){g.current=null,P.current=[o.x,o.y],t===-1?(V.current===null&&!R.current&&h({action:p.polygonFocused,args:{name:b}}),L.current=r.current.vertices.map(i=>[...i.coords.scrCoords])):(C.current||h({action:p.polygonFocused,args:{name:b}}),V.current=t),I.current=!0,U.current=!1}function j(){N(),g.current=null,h({action:p.polygonFocused,args:{name:b}})}function J(t){g.current===t?h(t===-1?{action:p.movePolygon,args:{pointCoords:v.current}}:{action:p.movePolygon,args:{pointCoords:v.current,sourceDetails:{vertex:t}}}):!U.current&&(V.current===null||t!==-1)&&!R.current&&h({action:p.polygonClicked,args:{name:b}}),t!==-1&&(V.current=null),I.current=!1}function B(t){z(),g.current===t&&h(t===-1?{action:p.movePolygon,args:{pointCoords:v.current}}:{action:p.movePolygon,args:{pointCoords:v.current,sourceInformation:{vertex:t}}}),g.current=null}function T(t,o){o.key==="Enter"&&(g.current===t&&h(t===-1?{action:p.movePolygon,args:{pointCoords:v.current}}:{action:p.movePolygon,args:{pointCoords:v.current,sourceInformation:{vertex:t}}}),g.current=null,h({action:p.polygonClicked,args:{name:b}}))}function N(){if(!C.current)for(let[t,o]of r.current.vertices.entries())x.current.includes(t)&&(o.setAttribute({fillcolor:"black"}),o.needsUpdate=!0,o.update())}function z(){if(!C.current)for(let[t,o]of r.current.vertices.entries())x.current.includes(t)&&(o.setAttribute({fillcolor:"none"}),o.needsUpdate=!0,o.update())}if(a)if(!r.current)r.current=Z();else if(!(e.numVertices>=2))W();else{let t=!0;for(let n of e.numericalVertices)Number.isFinite(n[0])||(t=!1),Number.isFinite(n[1])||(t=!1);if(e.numVertices>m.current){for(let n=m.current;n<e.numVertices;n++){let l={...w.current};x.current.includes(n)||(l.visible=!1);let F=a.create("point",[...e.numericalVertices[n]],l);r.current.addPoints(F)}X(r.current)}else if(e.numVertices<m.current){for(let n=m.current-1;n>=e.numVertices;n--)r.current.vertices[n].off("drag"),r.current.vertices[n].off("down"),r.current.vertices[n].off("hit"),r.current.vertices[n].off("up"),r.current.vertices[n].off("keyfocusout"),r.current.vertices[n].off("keydown"),r.current.removePoints(r.current.vertices[n]);X(r.current)}let o=!C.current&&!e.hidden;for(let n=0;n<e.numVertices;n++){r.current.vertices[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[n]]),r.current.vertices[n].needsUpdate=!0,r.current.vertices[n].update();let l=o&&x.current.includes(n);r.current.vertices[n].visProp.visible=l,r.current.vertices[n].visPropCalc.visible=l,r.current.vertices[n].visProp.showinfobox=e.showCoordsWhenDragging}if(E.sourceInformation&&b in E.sourceInformation){let n=E.sourceInformation[b].vertex;n!==void 0&&a.updateInfobox(r.current.vertices[n])}let i=!e.hidden;t||(i=!1),r.current.visProp.fixed=R.current,r.current.visProp.highlight=!O.current,r.current.isDraggable=!O.current,r.current.visProp.visible=i,r.current.visPropCalc.visible=i;let s=10*e.layer+A,d=r.current.visProp.layer!==s,c,f;d&&(c=10*e.layer+A,f=10*e.layer+$,r.current.setAttribute({layer:s}));let k=D==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,y=D==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;y=e.filled?y:"none",r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=k:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),r.current.visProp.fillcolor!==y&&(r.current.visProp.fillcolor=y,r.current.visProp.highlightfillcolor=y,r.current.visProp.hasinnerpoints=e.filled),r.current.visProp.fillopacity!==e.selectedStyle.fillOpacity&&(r.current.visProp.fillopacity=e.selectedStyle.fillOpacity,r.current.visProp.highlightfillopacity=e.selectedStyle.fillOpacity*.5),r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let n=0;n<r.current.borders.length;n++){let l=r.current.borders[n];l.visProp.visible=i,l.visPropCalc.visible=i,d&&l.setAttribute({layer:c}),l.visProp.strokecolor!==k&&(l.visProp.strokecolor=k,l.visProp.highlightstrokecolor=k),l.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(l.visProp.strokeopacity=e.selectedStyle.lineOpacity,l.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let F=q(e.selectedStyle.lineStyle);l.visProp.dash!==F&&(l.visProp.dash=F),l.visProp.strokewidth!==e.selectedStyle.lineWidth&&(l.visProp.strokewidth=e.selectedStyle.lineWidth,l.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),l.needsUpdate=!0,l.update()}if(d){w.current.layer=f;for(let n of r.current.vertices)n.setAttribute({layer:f}),n.needsUpdate=!0,n.update()}m.current=e.numVertices,a.updateRenderer()}return e.hidden?null:_.jsx(_.Fragment,{children:_.jsx("a",{name:Q})})});function q(S){return S==="solid"?0:S==="dashed"?2:S==="dotted"?1:0}export{se as default};
