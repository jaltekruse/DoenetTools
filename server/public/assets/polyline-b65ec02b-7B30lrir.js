import{R as ee,u as re,r as u,P as te,a as W}from"./index-DVZ7nus4.js";import{BoardContext as ne,LINE_LAYER_OFFSET as $,VERTEX_LAYER_OFFSET as q}from"./graph-1a05b976-BUHOs_UM.js";import"./css-5483d03f-CnY6i4xu.js";const ue=ee.memo(function w(Q){let{name:b,id:Z,SVs:e,actions:p,sourceOfUpdate:E,callAction:h}=re(Q);w.ignoreActionsWithoutCore=()=>!0;const c=u.useContext(ne);let r=u.useRef(null),o=u.useRef(null),y=u.useRef(null),m=u.useRef(null),F=u.useRef(null),C=u.useRef(null),M=u.useRef(null),A=u.useRef(!1),L=u.useRef(!1),x=u.useRef(null),P=u.useRef(null),R=u.useRef(null),O=u.useRef(!1),D=u.useRef(!1),V=u.useRef(!1),S=u.useRef([]);R.current=e.numericalVertices,O.current=e.fixed,D.current=!e.draggable||e.fixLocation||e.fixed,V.current=!e.verticesDraggable||e.fixed||e.fixLocation,S.current=e.vertexIndicesDraggable;const{darkMode:H}=u.useContext(te)||{};u.useEffect(()=>()=>{r.current&&T(),c&&c.off("move",J)},[]),u.useEffect(()=>{c&&c.on("move",J)},[c]);function z(){if(e.numericalVertices.length!==e.numVertices||e.numericalVertices.some(t=>t.length!==2))return null;let n=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(n=!1),Number.isFinite(t[1])||(n=!1);let l=H==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,d={name:e.labelForGraph,visible:!e.hidden&&n,withLabel:e.labelForGraph!=="",layer:10*e.layer+$,fixed:O.current,strokeColor:l,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:l,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:K(e.selectedStyle.lineStyle),highlight:!D.current,lineCap:"butt"};P.current=Object.assign({},d),Object.assign(P.current,{fixed:!1,highlight:!0,withLabel:!1,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:"black",layer:10*e.layer+q,showInfoBox:e.showCoordsWhenDragging}),(V.current||e.hidden||!n)&&(P.current.visible=!1),d.label={highlight:!1},e.labelHasLatex&&(d.label.useMathJax=!0),e.applyStyleToLabel?d.label.strokeColor=l:d.label.strokeColor="var(--canvastext)",o.current=[];for(let t=0;t<e.numVertices;t++){let a={...P.current};S.current.includes(t)||(a.visible=!1),o.current.push(c.create("point",[...e.numericalVertices[t]],a))}let v=[],k=[];e.numericalVertices.forEach(t=>{v.push(t[0]),k.push(t[1])});let f=c.create("curve",[v,k],d);f.isDraggable=!D.current;for(let t=0;t<e.numVertices;t++)o.current[t].on("drag",a=>Y(t,a)),o.current[t].on("up",()=>j(t)),o.current[t].on("keyfocusout",()=>G(t)),o.current[t].on("keydown",a=>U(t,a)),o.current[t].on("down",a=>I(t,a)),o.current[t].on("hit",a=>_());return f.on("drag",t=>Y(-1,t)),f.on("up",()=>j(-1)),f.on("keyfocusout",()=>G(-1)),f.on("keydown",t=>U(-1,t)),f.on("down",t=>I(-1,t)),f.on("hit",t=>_()),f.on("over",t=>{N()}),f.on("out",t=>{B()}),x.current=e.numVertices,f}function J(n){A.current&&(Math.abs(n.x-C.current[0])>.1||Math.abs(n.y-C.current[1])>.1)&&(L.current=!0)}function T(){r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),c.removeObject(r.current),r.current=null;for(let n=0;n<e.numVertices;n++){let l=o.current[n];l&&(l.off("drag"),l.off("down"),l.off("hit"),l.off("up"),l.off("keyfocusout"),l.off("keydown"),c.removeObject(l))}o.current=null}function Y(n,l){let d=l.type==="pointermove";if(!d||Math.abs(l.x-C.current[0])>.1||Math.abs(l.y-C.current[1])>.1)if(m.current=n,n===-1){r.current.updateTransformMatrix();let k=r.current.transformMat[1][0],f=r.current.transformMat[2][0];var v=c.origin.scrCoords;y.current=[];for(let t=0;t<r.current.points.length;t++)if(d){let a=(M.current[t][1]+l.x-C.current[0]-v[1])/c.unitX,X=(v[2]-(M.current[t][2]+l.y-C.current[1]))/c.unitY;y.current.push([a,X])}else y.current.push([r.current.dataX[t]+k,r.current.dataY[t]+f]);h({action:p.movePolyline,args:{pointCoords:y.current,transient:!0,skippable:!0}});for(let t=0;t<e.numVertices;t++)o.current[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...R.current[t]]),r.current.dataX[t]=R.current[t][0]-k,r.current.dataY[t]=R.current[t][1]-f}else y.current={},y.current[n]=[o.current[n].X(),o.current[n].Y()],h({action:p.movePolyline,args:{pointCoords:y.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),o.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...R.current[n]]),c.updateInfobox(o.current[n])}function I(n,l){m.current=null,C.current=[l.x,l.y],n===-1?(F.current===null&&!O.current&&h({action:p.polylineFocused,args:{name:b}}),M.current=r.current.points.map(d=>[...d.scrCoords])):(V.current||h({action:p.polylineFocused,args:{name:b}}),F.current=n),A.current=!0,L.current=!1}function _(){N(),m.current=null,h({action:p.polylineFocused,args:{name:b}})}function j(n){m.current===n?h(n===-1?{action:p.movePolyline,args:{pointCoords:y.current}}:{action:p.movePolyline,args:{pointCoords:y.current,sourceDetails:{vertex:n}}}):!L.current&&(F.current===null||n!==-1)&&!O.current&&h({action:p.polylineClicked,args:{name:b}}),n!==-1&&(F.current=null),A.current=!1}function G(n){B(),m.current===n&&h(n===-1?{action:p.movePolyline,args:{pointCoords:y.current}}:{action:p.movePolyline,args:{pointCoords:y.current,sourceInformation:{vertex:n}}}),m.current=null}function U(n,l){l.key==="Enter"&&(m.current===n&&h(n===-1?{action:p.movePolyline,args:{pointCoords:y.current}}:{action:p.movePolyline,args:{pointCoords:y.current,sourceInformation:{vertex:n}}}),m.current=null,h({action:p.polylineClicked,args:{name:b}}))}function N(){if(!V.current)for(let[n,l]of o.current.entries())S.current.includes(n)&&(l.setAttribute({fillcolor:"black"}),l.needsUpdate=!0,l.update())}function B(){if(!V.current)for(let[n,l]of o.current.entries())S.current.includes(n)&&(l.setAttribute({fillcolor:"none"}),l.needsUpdate=!0,l.update())}if(c)if(!r.current)r.current=z();else if(e.numericalVertices.length!==e.numVertices||e.numericalVertices.some(n=>n.length!==2))T();else{let n=!0;for(let i of e.numericalVertices)Number.isFinite(i[0])||(n=!1),Number.isFinite(i[1])||(n=!1);r.current.visProp.fixed=O.current,r.current.visProp.highlight=!D.current,r.current.isDraggable=!D.current;let l=10*e.layer+$,d=r.current.visProp.layer!==l,v=10*e.layer+q;if(d&&(r.current.setAttribute({layer:l}),P.current.layer=v),e.numVertices>x.current)for(let i=x.current;i<e.numVertices;i++){let s={...P.current};S.current.includes(i)||(s.visible=!1),o.current.push(c.create("point",[...e.numericalVertices[i]],s)),r.current.dataX.length=e.numVertices,o.current[i].on("drag",g=>Y(i,g)),o.current[i].on("up",g=>j(i)),o.current[i].on("down",g=>I(i,g)),o.current[i].on("hit",g=>_()),o.current[i].on("keyfocusout",g=>G(i)),o.current[i].on("keydown",g=>U(i,g))}else if(e.numVertices<x.current){for(let i=e.numVertices;i<x.current;i++){let s=o.current.pop();s.off("drag"),s.off("down"),s.off("hit"),s.off("up"),s.off("keyfocusout"),s.off("keydown"),c.removeObject(s)}r.current.dataX.length=e.numVertices}x.current=e.numVertices,r.current.updateTransformMatrix();let k=r.current.transformMat[1][0],f=r.current.transformMat[2][0];for(let i=0;i<e.numVertices;i++)o.current[i].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[i]]),r.current.dataX[i]=e.numericalVertices[i][0]-k,r.current.dataY[i]=e.numericalVertices[i][1]-f;let t=!e.hidden;if(n){r.current.visProp.visible=t,r.current.visPropCalc.visible=t;let i=t&&!V.current;for(let s=0;s<e.numVertices;s++){let g=i&&S.current.includes(s);o.current[s].visProp.visible=g,o.current[s].visPropCalc.visible=g,o.current[s].visProp.showinfobox=e.showCoordsWhenDragging}}else{r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;for(let i=0;i<e.numVertices;i++)o.current[i].visProp.visible=!1,o.current[i].visPropCalc.visible=!1}let a=H==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;r.current.visProp.strokecolor!==a&&(r.current.visProp.strokecolor=a,r.current.visProp.highlightstrokecolor=a),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let X=K(e.selectedStyle.lineStyle);if(r.current.visProp.dash!==X&&(r.current.visProp.dash=X),r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=a:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),E.sourceInformation&&b in E.sourceInformation){let i=E.sourceInformation[b].vertex;Number.isFinite(i)&&c.updateInfobox(o.current[i])}r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let i=0;i<e.numVertices;i++)d&&o.current[i].setAttribute({layer:v}),o.current[i].needsUpdate=!0,o.current[i].update();c.updateRenderer()}return e.hidden?null:W.jsx(W.Fragment,{children:W.jsx("a",{name:Z})})});function K(w){return w==="solid"?0:w==="dashed"?2:w==="dotted"?1:0}export{ue as default};
