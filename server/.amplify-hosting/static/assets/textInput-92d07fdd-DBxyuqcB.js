import{q as ee,u as ye,r as o,e as Ce,g as ke,C as oe,a,R as Re,F as O,f as we,b as Ve,c as Ae,d as je,M as Ie}from"./index-DVZ7nus4.js";import{s as ue}from"./css-5483d03f-CnY6i4xu.js";import{BoardContext as _e}from"./graph-1a05b976-BUHOs_UM.js";import{g as se}from"./graph-462f764a-C0kM6xFY.js";const j=ee.button`
    position: relative;
    height: 24px;
    width: 24px;
    display: inline-block;
    color: white;
    background-color: var(--mainBlue);
    padding: 2px;
    /* border: var(--mainBorder); */
    border: none;
    border-radius: var(--mainBorderRadius);
    margin: 0px 4px 4px 0px;

    &:hover {
        background-color: var(--lightBlue);
        color: black;
    }
`,Ne=ee.textarea`
    width: ${s=>s.width};
    height: ${s=>s.height}; // Same height as the checkWorkButton, accounting for the borders
    font-size: 14px;
    border: ${s=>s.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
    cursor: ${s=>s.disabled?"not-allowed":"auto"};

    &:focus {
        outline: var(--mainBorder);
        outline-offset: 2px;
    }
`,Se=ee.input`
    width: ${s=>s.width};
    height: 20px; // Same height as the checkWorkButton, accounting for the borders
    font-size: 14px;
    border: ${s=>s.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
    cursor: ${s=>s.disabled?"not-allowed":"auto"};

    &:focus {
        outline: var(--mainBorder);
        outline-offset: 2px;
    }
`;function le(s){let{name:Be,id:m,SVs:e,actions:p,sourceOfUpdate:Ee,ignoreUpdate:ce,rendererName:de,callAction:f}=ye(s),I=ue(e.width),pe=ue(e.height);le.baseStateVariable="immediateValue",le.ignoreActionsWithoutCore=n=>n==="moveInput";const[R,W]=o.useState(e.immediateValue);let C=o.useRef(null);C.current=R;const fe=Ce(ke(de));let _=o.useRef(e.immediateValue),te=o.useRef(null),w=o.useRef(null),t=o.useRef(null),N=o.useRef(null),S=o.useRef(null);const l=o.useContext(_e);let V=o.useRef(!1),M=o.useRef(!1),h=o.useRef(!1),v=o.useRef(null),b=o.useRef(null),re=o.useRef(null),T=o.useRef(null),$=o.useRef(!1),A=o.useRef(!1);$.current=e.fixed,A.current=!e.draggable||e.fixLocation||e.fixed,o.useEffect(()=>()=>{t.current!==null&&he()},[]),!ce&&w.current!==e.immediateValue?(W(e.immediateValue),w.current=e.immediateValue,_.current=e.immediateValue):w.current=null;let k="unvalidated";e.valueHasBeenValidated&&(e.creditAchieved===1?k="correct":e.creditAchieved===0?k="incorrect":k="partialcorrect");function B(n){n.key==="Enter"&&(_.current=C.current,f({action:p.updateValue,baseVariableValue:C.current}),e.includeCheckWork&&!e.suppressCheckwork&&!e.expanded&&k==="unvalidated"&&f({action:p.submitAnswer}))}function E(n){if(n.key==="Escape"){let r=_.current;r!==C.current&&(W(r),w.current=e.immediateValue,f({action:p.updateImmediateValue,args:{text:r},baseVariableValue:r}))}}function P(n){te.current=!0}function F(n){te.current=!1,_.current=C.current,f({action:p.updateValue,baseVariableValue:C.current})}function L(n){let r=n.target.value;r!==C.current&&(W(r),fe(x=>{let g={...x};return g.ignoreUpdate=!0,g}),w.current=e.immediateValue,f({action:p.updateImmediateValue,args:{text:r},baseVariableValue:r}))}function me(){let n={visible:!e.hidden,fixed:$.current,disabled:e.disabled,useMathJax:e.labelHasLatex,strokeColor:"var(--canvastext)",highlightStrokeColor:"var(--canvastext)",highlight:!A.current,parse:!1},r;try{let u=oe.fromAst(e.anchor),y=[u.get_component(0).evaluate_to_constant(),u.get_component(1).evaluate_to_constant()];Number.isFinite(y[0])||(y[0]=0,n.visible=!1),Number.isFinite(y[1])||(y[1]=0,n.visible=!1),r=l.create("point",y,{visible:!1})}catch{n.visible=!1,r=l.create("point",[0,0],{visible:!1});return}n.anchor=r;let{anchorx:x,anchory:g}=se(e.positionFromAnchor);n.anchorx=x,n.anchory=g,S.current=[x,g];let i=l.create("input",[0,0,R,e.label],n);i.isDraggable=!A.current,i.rendNodeInput.addEventListener("input",L),i.rendNodeInput.addEventListener("keypress",B),i.rendNodeInput.addEventListener("keydown",E),i.rendNodeInput.addEventListener("blur",F),i.rendNodeInput.addEventListener("focus",P),i.rendNodeInput.style.width=I,i.rendNodeInput.style.color="var(--canvastext)",i.rendNodeInput.style.background="var(--canvas)",i.rendNodeInput.style.borderColor="var(--canvastext)",i.rendNodeLabel.style.marginRight="2px",i.on("down",function(u){V.current=[u.x,u.y],M.current=[...r.coords.scrCoords],h.current=!1}),i.on("hit",function(u){h.current=!1}),i.on("up",function(u){h.current&&(f({action:p.moveInput,args:{x:v.current,y:b.current}}),h.current=!1)}),i.on("keyfocusout",function(u){h.current&&(f({action:p.moveInput,args:{x:v.current,y:b.current}}),h.current=!1)}),i.on("drag",function(u){let y=u.type==="pointermove";(!y||Math.abs(u.x-V.current[0])>.1||Math.abs(u.y-V.current[1])>.1)&&(h.current=!0);let[Y,z,H,q]=l.getBoundingBox(),Q=i.size[0]/l.unitX,Z=i.size[1]/l.unitY,ne=S.current[0],ae=S.current[1],J=0;ne==="middle"?J=-Q/2:ne==="right"&&(J=-Q);let U=0;ae==="middle"?U=-Z/2:ae==="top"&&(U=-Z);let xe=Y+.04*(H-Y)-J-Q,ve=H-.04*(H-Y)-J,be=q+.04*(z-q)-U-Z,ge=z-.04*(z-q)-U;if(y){var ie=l.origin.scrCoords;v.current=(M.current[1]+u.x-V.current[0]-ie[1])/l.unitX,b.current=(ie[2]-(M.current[2]+u.y-V.current[1]))/l.unitY}else v.current=r.X()+i.relativeCoords.usrCoords[1],b.current=r.Y()+i.relativeCoords.usrCoords[2];v.current=Math.min(ve,Math.max(xe,v.current)),b.current=Math.min(ge,Math.max(be,b.current)),f({action:p.moveInput,args:{x:v.current,y:b.current,transient:!0,skippable:!0}}),i.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),r.coords.setCoordinates(JXG.COORDS_BY_USER,re.current)}),i.on("keydown",function(u){u.key==="Enter"&&h.current&&(f({action:p.moveInput,args:{x:v.current,y:b.current}}),h.current=!1)}),t.current=i,N.current=r,T.current=e.positionFromAnchor,e.labelHasLatex&&setTimeout(()=>{t.current&&(t.current.needsUpdate=!0,t.current.setText(e.label),t.current.update(),l==null||l.updateRenderer())},1e3)}function he(){t.current.rendNodeInput.removeEventListener("input",L),t.current.rendNodeInput.removeEventListener("keypress",B),t.current.rendNodeInput.removeEventListener("keydown",E),t.current.rendNodeInput.removeEventListener("blur",F),t.current.rendNodeInput.removeEventListener("focus",P),t.current.off("drag"),t.current.off("down"),t.current.off("hit"),t.current.off("up"),t.current.off("keyfocusout"),t.current.off("keydown"),l.removeObject(t.current),t.current=null}if(l){let n;try{let r=oe.fromAst(e.anchor);n=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()]}catch{n=[NaN,NaN]}if(re.current=n,t.current===null)me();else{t.current.Value()!==R&&t.current.set(R),t.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),N.current.coords.setCoordinates(JXG.COORDS_BY_USER,n),t.current.setText(e.label),t.current.rendNodeInput.style.width=I;let r=!e.hidden;if(Number.isFinite(n[0])&&Number.isFinite(n[1])){let x=t.current.visProp.visible!==r;t.current.visProp.visible=r,t.current.visPropCalc.visible=r,x&&t.current.setAttribute({visible:r})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;if(t.current.visProp.disabled!==e.disabled&&(t.current.visProp.disabled=e.disabled,t.current.setAttribute({disabled:e.disabled})),t.current.visProp.highlight=!A.current,t.current.visProp.fixed=$.current,t.current.isDraggable=!A.current,t.current.needsUpdate=!0,e.positionFromAnchor!==T.current){let{anchorx:x,anchory:g}=se(e.positionFromAnchor);t.current.visProp.anchorx=x,t.current.visProp.anchory=g,S.current=[x,g],T.current=e.positionFromAnchor,t.current.fullUpdate()}else t.current.update();N.current.needsUpdate=!0,N.current.update(),l.updateRenderer()}return a.jsx("a",{name:m})}if(e.hidden)return null;let G=e.disabled;const X=m+"_input";let c={cursor:"pointer",padding:"1px 6px 1px 6px"};G&&(c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),c.cursor="not-allowed",c.color="black");let d=null;if(e.includeCheckWork&&!e.suppressCheckwork){if(k==="unvalidated")d=a.jsx(j,{id:m+"_submit",tabIndex:"0",disabled:G,style:c,onClick:()=>f({action:p.submitAnswer}),onKeyPress:n=>{n.key==="Enter"&&f({action:p.submitAnswer})},children:a.jsx(O,{style:{},icon:we,transform:{rotate:90}})});else if(e.showCorrectness)if(k==="correct")c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGreen"),d=a.jsx(j,{id:m+"_correct",style:c,children:a.jsx(O,{icon:Ve})});else if(k==="partialcorrect"){let r=`${Math.round(e.creditAchieved*100)} %`;c.width="44px",c.backgroundColor="#efab34",d=a.jsx(j,{id:m+"_partial",style:c,children:r})}else c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainRed"),d=a.jsx(j,{id:m+"_incorrect",style:c,children:a.jsx(O,{icon:Ae})});else c.backgroundColor="rgb(74, 3, 217)",c.padding="1px 8px 1px 4px",d=a.jsx(j,{id:m+"_saved",style:c,children:a.jsx(O,{icon:je})});e.numAttemptsLeft<0?d=a.jsxs(a.Fragment,{children:[d,a.jsx("span",{children:"(no attempts remaining)"})]}):e.numAttemptsLeft==1?d=a.jsxs(a.Fragment,{children:[d,a.jsx("span",{children:"(1 attempt remaining)"})]}):Number.isFinite(e.numAttemptsLeft)&&(d=a.jsxs(a.Fragment,{children:[d,a.jsxs("span",{children:["(attempts remaining: ",e.numAttemptsLeft,")"]})]}))}let K,D=e.label;return e.labelHasLatex&&(D=a.jsx(Ie,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:D})),e.expanded?K=a.jsxs("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[D,a.jsx(Ne,{id:X,value:R,disabled:G,onChange:L,onKeyPress:B,onKeyDown:E,onBlur:F,onFocus:P,width:I,height:pe,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},X)]}):K=a.jsxs("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[D,a.jsx(Se,{id:X,value:R,disabled:G,onChange:L,onKeyPress:B,onKeyDown:E,onBlur:F,onFocus:P,width:I,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},X)]}),a.jsxs(Re.Fragment,{children:[a.jsx("a",{name:m}),a.jsxs("span",{className:"textInputSurroundingBox",id:m,style:{display:"inline-flex",maxWidth:"100%"},children:[K,d]})]})}export{le as default};
